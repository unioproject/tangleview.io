!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Viva=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var random=require("ngraph.random"),Viva={lazyExtend:function(){return require("ngraph.merge").apply(this,arguments)},randomIterator:function(){return random.randomIterator.apply(random,arguments)},random:function(){return random.random.apply(random,arguments)},events:require("ngraph.events")};Viva.Graph={version:require("./version.js"),graph:require("ngraph.graph"),serializer:function(){return{loadFromJSON:require("ngraph.fromjson"),storeToJSON:require("ngraph.tojson")}},centrality:require("./Algorithms/centrality.js"),operations:require("./Algorithms/operations.js"),geom:function(){return{intersect:require("gintersect"),intersectRect:require("./Utils/intersectRect.js")}},webgl:require("./WebGL/webgl.js"),webglInputEvents:require("./WebGL/webglInputEvents.js"),generator:function(){return require("ngraph.generators")},Input:{domInputManager:require("./Input/domInputManager.js"),webglInputManager:require("./Input/webglInputManager.js")},Utils:{dragndrop:require("./Input/dragndrop.js"),findElementPosition:require("./Utils/findElementPosition.js"),timer:require("./Utils/timer.js"),getDimension:require("./Utils/getDimensions.js"),events:require("./Utils/backwardCompatibleEvents.js")},Layout:{forceDirected:require("ngraph.forcelayout"),constant:require("./Layout/constant.js")},View:{Texture:require("./WebGL/texture.js"),webglAtlas:require("./WebGL/webglAtlas.js"),webglImageNodeProgram:require("./WebGL/webglImageNodeProgram.js"),webglLinkProgram:require("./WebGL/webglLinkProgram.js"),webglNodeProgram:require("./WebGL/webglNodeProgram.js"),webglLine:require("./WebGL/webglLine.js"),webglSquare:require("./WebGL/webglSquare.js"),webglImage:require("./WebGL/webglImage.js"),webglGraphics:require("./View/webglGraphics.js"),_webglUtil:{parseColor:require("./WebGL/parseColor.js")},svgGraphics:require("./View/svgGraphics.js"),renderer:require("./View/renderer.js"),cssGraphics:function(){throw new Error("cssGraphics is deprecated. Please use older version of vivagraph (< 0.7) if you need it")},svgNodeFactory:function(){throw new Error("svgNodeFactory is deprecated. Please use older version of vivagraph (< 0.7) if you need it")},community:function(){throw new Error("community is deprecated. Please use vivagraph < 0.7 if you need it, or `https://github.com/anvaka/ngraph.slpa` module")}},Rect:require("./Utils/rect.js"),svg:require("simplesvg"),BrowserInfo:require("./Utils/browserInfo.js")},module.exports=Viva},{"./Algorithms/centrality.js":32,"./Algorithms/operations.js":33,"./Input/domInputManager.js":34,"./Input/dragndrop.js":35,"./Input/webglInputManager.js":36,"./Layout/constant.js":37,"./Utils/backwardCompatibleEvents.js":38,"./Utils/browserInfo.js":39,"./Utils/findElementPosition.js":41,"./Utils/getDimensions.js":42,"./Utils/intersectRect.js":43,"./Utils/rect.js":45,"./Utils/timer.js":46,"./View/renderer.js":48,"./View/svgGraphics.js":49,"./View/webglGraphics.js":50,"./WebGL/parseColor.js":51,"./WebGL/texture.js":52,"./WebGL/webgl.js":53,"./WebGL/webglAtlas.js":54,"./WebGL/webglImage.js":55,"./WebGL/webglImageNodeProgram.js":56,"./WebGL/webglInputEvents.js":57,"./WebGL/webglLine.js":58,"./WebGL/webglLinkProgram.js":59,"./WebGL/webglNodeProgram.js":60,"./WebGL/webglSquare.js":61,"./version.js":62,gintersect:3,"ngraph.events":7,"ngraph.forcelayout":9,"ngraph.fromjson":10,"ngraph.generators":11,"ngraph.graph":12,"ngraph.merge":13,"ngraph.random":26,"ngraph.tojson":27,simplesvg:28}],2:[function(require,module,exports){addEventListener.removeEventListener=removeEventListener,addEventListener.addEventListener=addEventListener,module.exports=addEventListener;var Events=null;function addEventListener(el,eventName,listener,useCapture){return(Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach})).add(el,eventName,listener,useCapture)}function removeEventListener(el,eventName,listener,useCapture){return(Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach})).rm(el,eventName,listener,useCapture)}function stdAttach(el,eventName,listener,useCapture){el.addEventListener(eventName,listener,useCapture)}function stdDetach(el,eventName,listener,useCapture){el.removeEventListener(eventName,listener,useCapture)}function oldIEAttach(el,eventName,listener,useCapture){if(useCapture)throw new Error("cannot useCapture in oldIE");el.attachEvent("on"+eventName,listener)}function oldIEDetach(el,eventName,listener,useCapture){el.detachEvent("on"+eventName,listener)}},{}],3:[function(require,module,exports){function intersect(x1,y1,x2,y2,x3,y3,x4,y4){var a1,a2,b1,b2,c1,c2,r1,r2,r3,r4,denom,offset,num,result={x:0,y:0};return r4=(a1=y2-y1)*x4+(b1=x1-x2)*y4+(c1=x2*y1-x1*y2),0!==(r3=a1*x3+b1*y3+c1)&&0!==r4&&r3>=0==r4>=4?null:(r2=(a2=y4-y3)*x2+(b2=x3-x4)*y2+(c2=x4*y3-x3*y4),0!==(r1=a2*x1+b2*y1+c2)&&0!==r2&&r1>=0==r2>=0?null:0===(denom=a1*b2-a2*b1)?null:(offset=denom<0?-denom/2:denom/2,offset=0,num=b1*c2-b2*c1,result.x=(num<0?num-0:num+0)/denom,num=a2*c1-a1*c2,result.y=(num<0?num-0:num+0)/denom,result))}module.exports=intersect},{}],4:[function(require,module,exports){module.exports.degree=require("./src/degree.js"),module.exports.betweenness=require("./src/betweenness.js")},{"./src/betweenness.js":5,"./src/degree.js":6}],5:[function(require,module,exports){function betweennes(graph,oriented){var Q=[],S=[],pred=Object.create(null),dist=Object.create(null),sigma=Object.create(null),delta=Object.create(null),currentNode,centrality=Object.create(null);return graph.forEachNode(setCentralityToZero),graph.forEachNode(calculateCentrality),oriented||Object.keys(centrality).forEach(divideByTwo),centrality;function divideByTwo(key){centrality[key]/=2}function setCentralityToZero(node){centrality[node.id]=0}function calculateCentrality(node){singleSourceShortestPath(currentNode=node.id),accumulate()}function accumulate(){for(graph.forEachNode(setDeltaToZero);S.length;){for(var w=S.pop(),coeff=(1+delta[w])/sigma[w],predcessors=pred[w],idx=0;idx<predcessors.length;++idx){var v=predcessors[idx];delta[v]+=sigma[v]*coeff}w!==currentNode&&(centrality[w]+=delta[w])}}function setDeltaToZero(node){delta[node.id]=0}function singleSourceShortestPath(source){for(graph.forEachNode(initNode),dist[source]=0,sigma[source]=1,Q.push(source);Q.length;){var v=Q.shift(),dedup=Object.create(null);S.push(v),graph.forEachLinkedNode(v,toId,oriented)}function toId(otherNode){processNode(otherNode.id)}function initNode(node){var nodeId=node.id;pred[nodeId]=[],dist[nodeId]=-1,sigma[nodeId]=0}function processNode(w){-1===dist[w]&&(dist[w]=dist[v]+1,Q.push(w)),dist[w]===dist[v]+1&&(sigma[w]+=sigma[v],pred[w].push(v))}}}module.exports=betweennes},{}],6:[function(require,module,exports){function degree(graph,kind){var getNodeDegree,sortedDegrees=[],result=Object.create(null),nodeDegree;if("both"===(kind=(kind||"both").toLowerCase())||"inout"===kind)getNodeDegree=inoutDegreeCalculator;else if("in"===kind)getNodeDegree=inDegreeCalculator;else{if("out"!==kind)throw new Error("Expected centrality degree kind is: in, out or both");getNodeDegree=outDegreeCalculator}return graph.forEachNode(calculateNodeDegree),result;function calculateNodeDegree(node){var links=graph.getLinks(node.id);result[node.id]=getNodeDegree(links,node.id)}}function inDegreeCalculator(links,nodeId){for(var total=0,i=0;i<links.length;i+=1)total+=links[i].toId===nodeId?1:0;return total}function outDegreeCalculator(links,nodeId){for(var total=0,i=0;i<links.length;i+=1)total+=links[i].fromId===nodeId?1:0;return total}function inoutDegreeCalculator(links){return links.length}module.exports=degree},{}],7:[function(require,module,exports){function createEventsStorage(subject){var registeredEvents=Object.create(null);return{on:function(eventName,callback,ctx){if("function"!=typeof callback)throw new Error("callback is expected to be a function");var handlers=registeredEvents[eventName];return handlers||(handlers=registeredEvents[eventName]=[]),handlers.push({callback:callback,ctx:ctx}),subject},off:function(eventName,callback){var wantToRemoveAll,deleteAllCallbacksForEvent;if(void 0===eventName)return registeredEvents=Object.create(null),subject;if(registeredEvents[eventName])if("function"!=typeof callback)delete registeredEvents[eventName];else for(var callbacks=registeredEvents[eventName],i=0;i<callbacks.length;++i)callbacks[i].callback===callback&&callbacks.splice(i,1);return subject},fire:function(eventName){var callbacks=registeredEvents[eventName],fireArguments;if(!callbacks)return subject;arguments.length>1&&(fireArguments=Array.prototype.splice.call(arguments,1));for(var i=0;i<callbacks.length;++i){var callbackInfo=callbacks[i];callbackInfo.callback.apply(callbackInfo.ctx,fireArguments)}return subject}}}function validateSubject(subject){if(!subject)throw new Error("Eventify cannot use falsy object as events subject");for(var reservedWords=["on","fire","off"],i=0;i<reservedWords.length;++i)if(subject.hasOwnProperty(reservedWords[i]))throw new Error("Subject cannot be eventified, since it already has property '"+reservedWords[i]+"'")}module.exports=function(subject){validateSubject(subject);var eventsStorage=createEventsStorage(subject);return subject.on=eventsStorage.on,subject.off=eventsStorage.off,subject.fire=eventsStorage.fire,subject}},{}],8:[function(require,module,exports){function exposeProperties(settings,target,filter){var needsFilter;if("[object Array]"===Object.prototype.toString.call(filter))for(var i=0;i<filter.length;++i)augment(settings,target,filter[i]);else for(var key in settings)augment(settings,target,key)}function augment(source,target,key){if(source.hasOwnProperty(key)){if("function"==typeof target[key])return;target[key]=function(value){return void 0!==value?(source[key]=value,target):source[key]}}}module.exports=exposeProperties},{}],9:[function(require,module,exports){module.exports=createLayout,module.exports.simulator=require("ngraph.physics.simulator");var eventify=require("ngraph.events");function createLayout(graph,physicsSettings){if(!graph)throw new Error("Graph structure cannot be undefined");var createSimulator,physicsSimulator=require("ngraph.physics.simulator")(physicsSettings),nodeBodies=Object.create(null),springs={},bodiesCount=0,springTransform=physicsSimulator.settings.springTransform||noop;initPhysics(),listenToEvents();var wasStable=!1,api={step:function(){if(0===bodiesCount)return!0;var lastMove=physicsSimulator.step();api.lastMove=lastMove,api.fire("step");var isStableNow=!1;return!1!==wasStable&&(wasStable=!1,onStableChanged(!1)),!1},setForce:function(force){physicsSimulator.setForce(force)},getNodePosition:function(nodeId){return getInitializedBody(nodeId).pos},setNodePosition:function(nodeId){var body=getInitializedBody(nodeId);body.setPosition.apply(body,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(linkId){var spring=springs[linkId];if(spring)return{from:spring.from.pos,to:spring.to.pos}},getGraphRect:function(){return physicsSimulator.getBBox()},forEachBody:forEachBody,pinNode:function(node,isPinned){var body;getInitializedBody(node.id).isPinned=!!isPinned},isNodePinned:function(node){return getInitializedBody(node.id).isPinned},dispose:function(){graph.off("changed",onGraphChanged),api.fire("disposed")},getBody:getBody,getSpring:getSpring,simulator:physicsSimulator,graph:graph,lastMove:0};return eventify(api),api;function forEachBody(cb){Object.keys(nodeBodies).forEach(function(bodyId){cb(nodeBodies[bodyId],bodyId)})}function getSpring(fromId,toId){var linkId;if(void 0===toId)linkId="object"!=typeof fromId?fromId:fromId.id;else{var link=graph.hasLink(fromId,toId);if(!link)return;linkId=link.id}return springs[linkId]}function getBody(nodeId){return nodeBodies[nodeId]}function listenToEvents(){graph.on("changed",onGraphChanged)}function onStableChanged(isStable){api.fire("stable",isStable)}function onGraphChanged(changes){for(var i=0;i<changes.length;++i){var change=changes[i];"add"===change.changeType?(change.node&&initBody(change.node.id,change.node.position),change.link&&initLink(change.link)):"remove"===change.changeType&&(change.node&&releaseNode(change.node),change.link&&releaseLink(change.link))}bodiesCount=graph.getNodesCount()}function initPhysics(){bodiesCount=0,graph.forEachNode(function(node){initBody(node.id),bodiesCount+=1}),graph.forEachLink(initLink)}function initBody(nodeId,position){var body=nodeBodies[nodeId];if(!body){var node=graph.getNode(nodeId);if(!node)throw new Error("initBody() was called with unknown node id");var pos=position||node.position;if(!pos){var neighbors=getNeighborBodies(node);pos=physicsSimulator.getBestNewBodyPosition(neighbors)}(body=physicsSimulator.addBodyAt(pos)).id=nodeId,nodeBodies[nodeId]=body,updateBodyMass(nodeId),isNodeOriginallyPinned(node)&&(body.isPinned=!0)}}function releaseNode(node){var nodeId=node.id,body=nodeBodies[nodeId];body&&(nodeBodies[nodeId]=null,delete nodeBodies[nodeId],physicsSimulator.removeBody(body))}function initLink(link){updateBodyMass(link.fromId),updateBodyMass(link.toId);var fromBody=nodeBodies[link.fromId],toBody=nodeBodies[link.toId],spring=physicsSimulator.addSpring(fromBody,toBody,link.length);springTransform(link,spring),springs[link.id]=spring}function releaseLink(link){var spring=springs[link.id];if(spring){var from=graph.getNode(link.fromId),to=graph.getNode(link.toId);from&&updateBodyMass(from.id),to&&updateBodyMass(to.id),delete springs[link.id],physicsSimulator.removeSpring(spring)}}function getNeighborBodies(node){var neighbors=[];if(!node.links)return neighbors;for(var maxNeighbors=Math.min(node.links.length,2),i=0;i<maxNeighbors;++i){var link=node.links[i],otherBody=link.fromId!==node.id?nodeBodies[link.fromId]:nodeBodies[link.toId];otherBody&&otherBody.pos&&neighbors.push(otherBody)}return neighbors}function updateBodyMass(nodeId){var body;nodeBodies[nodeId].mass=nodeMass(nodeId)}function isNodeOriginallyPinned(node){return node&&(node.isPinned||node.data&&node.data.isPinned)}function getInitializedBody(nodeId){var body=nodeBodies[nodeId];return body||(initBody(nodeId),body=nodeBodies[nodeId]),body}function nodeMass(nodeId){var links=graph.getLinks(nodeId);return links?1+links.length/3:1}}function noop(){}},{"ngraph.events":7,"ngraph.physics.simulator":15}],10:[function(require,module,exports){module.exports=load;var createGraph=require("ngraph.graph");function load(jsonGraph,nodeTransform,linkTransform){var stored;nodeTransform=nodeTransform||id,linkTransform=linkTransform||id,stored="string"==typeof jsonGraph?JSON.parse(jsonGraph):jsonGraph;var graph=createGraph(),i;if(void 0===stored.links||void 0===stored.nodes)throw new Error("Cannot load graph without links and nodes");for(i=0;i<stored.nodes.length;++i){var parsedNode=nodeTransform(stored.nodes[i]);if(!parsedNode.hasOwnProperty("id"))throw new Error("Graph node format is invalid: Node id is missing");graph.addNode(parsedNode.id,parsedNode.data)}for(i=0;i<stored.links.length;++i){var link=linkTransform(stored.links[i]);if(!link.hasOwnProperty("fromId")||!link.hasOwnProperty("toId"))throw new Error("Graph link format is invalid. Both fromId and toId are required");graph.addLink(link.fromId,link.toId,link.data)}return graph}function id(x){return x}},{"ngraph.graph":12}],11:[function(require,module,exports){module.exports={ladder:ladder,complete:complete,completeBipartite:completeBipartite,balancedBinTree:balancedBinTree,path:path,circularLadder:circularLadder,grid:grid,grid3:grid3,noLinks:noLinks,wattsStrogatz:wattsStrogatz};var createGraph=require("ngraph.graph");function ladder(n){if(!n||n<0)throw new Error("Invalid number of nodes");var g=createGraph(),i;for(i=0;i<n-1;++i)g.addLink(i,i+1),g.addLink(n+i,n+i+1),g.addLink(i,n+i);return g.addLink(n-1,2*n-1),g}function circularLadder(n){if(!n||n<0)throw new Error("Invalid number of nodes");var g=ladder(n);return g.addLink(0,n-1),g.addLink(n,2*n-1),g}function complete(n){if(!n||n<1)throw new Error("At least two nodes are expected for complete graph");var g=createGraph(),i,j;for(i=0;i<n;++i)for(j=i+1;j<n;++j)i!==j&&g.addLink(i,j);return g}function completeBipartite(n,m){if(!n||!m||n<0||m<0)throw new Error("Graph dimensions are invalid. Number of nodes in each partition should be greater than 0");var g=createGraph(),i,j;for(i=0;i<n;++i)for(j=n;j<n+m;++j)g.addLink(i,j);return g}function path(n){if(!n||n<0)throw new Error("Invalid number of nodes");var g=createGraph(),i;for(g.addNode(0),i=1;i<n;++i)g.addLink(i-1,i);return g}function grid(n,m){if(n<1||m<1)throw new Error("Invalid number of nodes in grid graph");var g=createGraph(),i,j;if(1===n&&1===m)return g.addNode(0),g;for(i=0;i<n;++i)for(j=0;j<m;++j){var node=i+j*n;i>0&&g.addLink(node,i-1+j*n),j>0&&g.addLink(node,i+(j-1)*n)}return g}function grid3(n,m,z){if(n<1||m<1||z<1)throw new Error("Invalid number of nodes in grid3 graph");var g=createGraph(),i,j,k;if(1===n&&1===m&&1===z)return g.addNode(0),g;for(k=0;k<z;++k)for(i=0;i<n;++i)for(j=0;j<m;++j){var level=k*n*m,node=i+j*n+level;i>0&&g.addLink(node,i-1+j*n+level),j>0&&g.addLink(node,i+(j-1)*n+level),k>0&&g.addLink(node,i+j*n+(k-1)*n*m)}return g}function balancedBinTree(n){if(n<0)throw new Error("Invalid number of nodes in balanced tree");var g=createGraph(),count=Math.pow(2,n),level;for(0===n&&g.addNode(1),level=1;level<count;++level){var root=level,left=2*root,right=2*root+1;g.addLink(root,left),g.addLink(root,right)}return g}function noLinks(n){if(n<0)throw new Error("Number of nodes shoul be >= 0");var g=createGraph(),i;for(i=0;i<n;++i)g.addNode(i);return g}function wattsStrogatz(n,k,p,seed){if(k>=n)throw new Error("Choose smaller `k`. It cannot be larger than number of nodes `n`");var random=require("ngraph.random").random(seed||42),g=createGraph(),i,to;for(i=0;i<n;++i)g.addNode(i);for(var neighborsSize=Math.floor(k/2+1),j=1;j<neighborsSize;++j)for(i=0;i<n;++i)to=(j+i)%n,g.addLink(i,to);for(j=1;j<neighborsSize;++j)for(i=0;i<n;++i)if(random.nextDouble()<p){var from=i;to=(j+i)%n;var newTo=random.next(n),needsRewire=newTo===from||g.hasLink(from,newTo);if(needsRewire&&g.getLinks(from).length===n-1)continue;for(;needsRewire;)needsRewire=(newTo=random.next(n))===from||g.hasLink(from,newTo);var link=g.hasLink(from,to);g.removeLink(link),g.addLink(from,newTo)}return g}},{"ngraph.graph":12,"ngraph.random":26}],12:[function(require,module,exports){module.exports=createGraph;var eventify=require("ngraph.events");function createGraph(options){void 0===(options=options||{}).uniqueLinkId&&(options.uniqueLinkId=!0);var nodes="function"==typeof Object.create?Object.create(null):{},links=[],multiEdges={},nodesCount=0,suspendEvents=0,forEachNode=createNodeIterator(),createLink=options.uniqueLinkId?createUniqueLink:createSingleLink,changes=[],recordLinkChange=noop,recordNodeChange=noop,enterModification=noop,exitModification=noop,graphPart={addNode:addNode,addLink:addLink,removeLink:removeLink,removeNode:removeNode,getNode:getNode,getNodesCount:function(){return nodesCount},getLinksCount:function(){return links.length},getLinks:getLinks,forEachNode:forEachNode,forEachLinkedNode:forEachLinkedNode,forEachLink:forEachLink,beginUpdate:enterModification,endUpdate:exitModification,clear:clear,hasLink:getLink,getLink:getLink};return eventify(graphPart),monitorSubscribers(),graphPart;function monitorSubscribers(){var realOn=graphPart.on;function on(){return graphPart.beginUpdate=enterModification=enterModificationReal,graphPart.endUpdate=exitModification=exitModificationReal,recordLinkChange=recordLinkChangeReal,recordNodeChange=recordNodeChangeReal,graphPart.on=realOn,realOn.apply(graphPart,arguments)}graphPart.on=on}function recordLinkChangeReal(link,changeType){changes.push({link:link,changeType:changeType})}function recordNodeChangeReal(node,changeType){changes.push({node:node,changeType:changeType})}function addNode(nodeId,data,position){if(void 0===nodeId)throw new Error("Invalid node identifier");enterModification();var node=getNode(nodeId);return node?recordNodeChange(node,"update"):(node=new Node(nodeId),nodesCount++,node.position=position,recordNodeChange(node,"add")),node.data=data,nodes[nodeId]=node,exitModification(),node}function getNode(nodeId){return nodes[nodeId]}function removeNode(nodeId){var node=getNode(nodeId);if(!node)return!1;for(enterModification();node.links.length;){var link;removeLink(node.links[0])}return delete nodes[nodeId],nodesCount--,recordNodeChange(node,"remove"),exitModification(),!0}function addLink(fromId,toId,data){enterModification();var fromNode=getNode(fromId)||addNode(fromId),toNode=getNode(toId)||addNode(toId),link=createLink(fromId,toId,data);return links.push(link),fromNode.links.push(link),fromId!==toId&&toNode.links.push(link),recordLinkChange(link,"add"),exitModification(),link}function createSingleLink(fromId,toId,data){var linkId=fromId.toString()+toId.toString();return new Link(fromId,toId,data,linkId)}function createUniqueLink(fromId,toId,data){var linkId=fromId.toString()+"👉 "+toId.toString(),isMultiEdge=multiEdges.hasOwnProperty(linkId);return(isMultiEdge||getLink(fromId,toId))&&(isMultiEdge||(multiEdges[linkId]=0),linkId+="@"+ ++multiEdges[linkId]),new Link(fromId,toId,data,linkId)}function getLinks(nodeId){var node=getNode(nodeId);return node?node.links:null}function removeLink(link){if(!link)return!1;var idx=indexOfElementInArray(link,links);if(idx<0)return!1;enterModification(),links.splice(idx,1);var fromNode=getNode(link.fromId),toNode=getNode(link.toId);return fromNode&&(idx=indexOfElementInArray(link,fromNode.links))>=0&&fromNode.links.splice(idx,1),toNode&&(idx=indexOfElementInArray(link,toNode.links))>=0&&toNode.links.splice(idx,1),recordLinkChange(link,"remove"),exitModification(),!0}function getLink(fromNodeId,toNodeId){var node=getNode(fromNodeId),i;if(!node)return null;for(i=0;i<node.links.length;++i){var link=node.links[i];if(link.fromId===fromNodeId&&link.toId===toNodeId)return link}return null}function clear(){enterModification(),forEachNode(function(node){removeNode(node.id)}),exitModification()}function forEachLink(callback){var i,length;if("function"==typeof callback)for(i=0,length=links.length;i<length;++i)callback(links[i])}function forEachLinkedNode(nodeId,callback,oriented){var node=getNode(nodeId);if(node&&node.links&&"function"==typeof callback)return oriented?forEachOrientedLink(node.links,nodeId,callback):forEachNonOrientedLink(node.links,nodeId,callback)}function forEachNonOrientedLink(links,nodeId,callback){for(var quitFast,i=0;i<links.length;++i){var link=links[i],linkedNodeId=link.fromId===nodeId?link.toId:link.fromId;if(quitFast=callback(nodes[linkedNodeId],link))return!0}}function forEachOrientedLink(links,nodeId,callback){for(var quitFast,i=0;i<links.length;++i){var link=links[i];if(link.fromId===nodeId&&(quitFast=callback(nodes[link.toId],link)))return!0}}function noop(){}function enterModificationReal(){suspendEvents+=1}function exitModificationReal(){0===(suspendEvents-=1)&&changes.length>0&&(graphPart.fire("changed",changes),changes.length=0)}function createNodeIterator(){return Object.keys?objectKeysIterator:forInIterator}function objectKeysIterator(callback){if("function"==typeof callback)for(var keys=Object.keys(nodes),i=0;i<keys.length;++i)if(callback(nodes[keys[i]]))return!0}function forInIterator(callback){var node;if("function"==typeof callback)for(node in nodes)if(callback(nodes[node]))return!0}}function indexOfElementInArray(element,array){if(array.indexOf)return array.indexOf(element);var len=array.length,i;for(i=0;i<len;i+=1)if(array[i]===element)return i;return-1}function Node(id){this.id=id,this.links=[],this.data=null}function Link(fromId,toId,data,id){this.fromId=fromId,this.toId=toId,this.data=data,this.id=id}},{"ngraph.events":7}],13:[function(require,module,exports){function merge(target,options){var key;if(target||(target={}),options)for(key in options)if(options.hasOwnProperty(key)){var targetHasIt=target.hasOwnProperty(key),optionsValueType=typeof options[key],shouldReplace;!targetHasIt||typeof target[key]!==optionsValueType?target[key]=options[key]:"object"===optionsValueType&&(target[key]=merge(target[key],options[key]))}return target}module.exports=merge},{}],14:[function(require,module,exports){function Body(x,y){this.pos=new Vector2d(x,y),this.prevPos=new Vector2d(x,y),this.force=new Vector2d,this.velocity=new Vector2d,this.mass=1}function Vector2d(x,y){x&&"number"!=typeof x?(this.x="number"==typeof x.x?x.x:0,this.y="number"==typeof x.y?x.y:0):(this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0)}function Body3d(x,y,z){this.pos=new Vector3d(x,y,z),this.prevPos=new Vector3d(x,y,z),this.force=new Vector3d,this.velocity=new Vector3d,this.mass=1}function Vector3d(x,y,z){x&&"number"!=typeof x?(this.x="number"==typeof x.x?x.x:0,this.y="number"==typeof x.y?x.y:0,this.z="number"==typeof x.z?x.z:0):(this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0,this.z="number"==typeof z?z:0)}module.exports={Body:Body,Vector2d:Vector2d,Body3d:Body3d,Vector3d:Vector3d},Body.prototype.setPosition=function(x,y){this.prevPos.x=this.pos.x=x,this.prevPos.y=this.pos.y=y},Vector2d.prototype.reset=function(){this.x=this.y=0},Body3d.prototype.setPosition=function(x,y,z){this.prevPos.x=this.pos.x=x,this.prevPos.y=this.pos.y=y,this.prevPos.z=this.pos.z=z},Vector3d.prototype.reset=function(){this.x=this.y=this.z=0}},{}],15:[function(require,module,exports){function physicsSimulator(settings){var Spring=require("./lib/spring"),expose=require("ngraph.expose"),merge=require("ngraph.merge"),eventify=require("ngraph.events"),createQuadTree=(settings=merge(settings,{springLength:30,springCoeff:8e-4,gravity:-1.2,theta:.8,dragCoeff:.02,timeStep:20,force:{x:0,y:0}})).createQuadTree||require("ngraph.quadtreebh"),createBounds=settings.createBounds||require("./lib/bounds"),createDragForce=settings.createDragForce||require("./lib/dragForce"),createSpringForce=settings.createSpringForce||require("./lib/springForce"),integrate=settings.integrator||require("./lib/eulerIntegrator"),createBody=settings.createBody||require("./lib/createBody"),bodies=[],springs=[],quadTree=createQuadTree(settings),bounds=createBounds(bodies,settings),springForce=createSpringForce(settings),dragForce=createDragForce(settings),totalMovement=0,publicApi={bodies:bodies,quadTree:quadTree,springs:springs,settings:settings,step:function(){accumulateForces();var movement=integrate(bodies,settings.timeStep);return bounds.update(),movement},addBody:function(body){if(!body)throw new Error("Body is required");return bodies.push(body),body},addBodyAt:function(pos){if(!pos)throw new Error("Body position is required");var body=createBody(pos);return bodies.push(body),body},removeBody:function(body){if(body){var idx=bodies.indexOf(body);if(!(idx<0))return bodies.splice(idx,1),0===bodies.length&&bounds.reset(),!0}},addSpring:function(body1,body2,springLength,springWeight,springCoefficient){if(!body1||!body2)throw new Error("Cannot add null spring to force simulator");"number"!=typeof springLength&&(springLength=-1);var spring=new Spring(body1,body2,springLength,springCoefficient>=0?springCoefficient:-1,springWeight);return springs.push(spring),spring},getTotalMovement:function(){return 0},removeSpring:function(spring){if(spring){var idx=springs.indexOf(spring);return idx>-1?(springs.splice(idx,1),!0):void 0}},getBestNewBodyPosition:function(neighbors){return bounds.getBestNewPosition(neighbors)},getBBox:function(){return bounds.box},gravity:function(value){return void 0!==value?(settings.gravity=value,quadTree.options({gravity:value}),this):settings.gravity},theta:function(value){return void 0!==value?(settings.theta=value,quadTree.options({theta:value}),this):settings.theta},setForce:function(value){return void 0!==value?(settings.force=value,quadTree.options({force:value}),this):settings.force}};return expose(settings,publicApi),eventify(publicApi),publicApi;function accumulateForces(){var body,i=bodies.length;if(i)for(quadTree.insertBodies(bodies);i--;)(body=bodies[i]).isPinned||(body.force.reset(),quadTree.updateBodyForce(body),dragForce.update(body));for(i=springs.length;i--;)springForce.update(springs[i])}}module.exports=physicsSimulator},{"./lib/bounds":16,"./lib/createBody":17,"./lib/dragForce":18,"./lib/eulerIntegrator":19,"./lib/spring":20,"./lib/springForce":21,"ngraph.events":7,"ngraph.expose":8,"ngraph.merge":13,"ngraph.quadtreebh":22}],16:[function(require,module,exports){module.exports=function(bodies,settings){var random=require("ngraph.random").random(42),boundingBox={x1:0,y1:0,x2:0,y2:0};return{box:boundingBox,update:updateBoundingBox,reset:function(){boundingBox.x1=boundingBox.y1=0,boundingBox.x2=boundingBox.y2=0},getBestNewPosition:function(neighbors){var graphRect=boundingBox,baseX=0,baseY=0;if(neighbors.length){for(var i=0;i<neighbors.length;++i)baseX+=neighbors[i].pos.x,baseY+=neighbors[i].pos.y;baseX/=neighbors.length,baseY/=neighbors.length}else baseX=(graphRect.x1+graphRect.x2)/2,baseY=(graphRect.y1+graphRect.y2)/2;var springLength=settings.springLength;return{x:baseX+random.next(springLength)-springLength/2,y:baseY+random.next(springLength)-springLength/2}}};function updateBoundingBox(){var i=bodies.length;if(0!==i){for(var x1=Number.MAX_VALUE,y1=Number.MAX_VALUE,x2=Number.MIN_VALUE,y2=Number.MIN_VALUE;i--;){var body=bodies[i];body.isPinned?(body.pos.x=body.prevPos.x,body.pos.y=body.prevPos.y):(body.prevPos.x=body.pos.x,body.prevPos.y=body.pos.y),body.pos.x<x1&&(x1=body.pos.x),body.pos.x>x2&&(x2=body.pos.x),body.pos.y<y1&&(y1=body.pos.y),body.pos.y>y2&&(y2=body.pos.y)}boundingBox.x1=x1,boundingBox.x2=x2,boundingBox.y1=y1,boundingBox.y2=y2}}}},{"ngraph.random":26}],17:[function(require,module,exports){var physics=require("ngraph.physics.primitives");module.exports=function(pos){return new physics.Body(pos)}},{"ngraph.physics.primitives":14}],18:[function(require,module,exports){module.exports=function(options){var merge=require("ngraph.merge"),expose,api={update:function(body){body.force.x-=options.dragCoeff*body.velocity.x,body.force.y-=options.dragCoeff*body.velocity.y}};return require("ngraph.expose")(options=merge(options,{dragCoeff:.02}),api,["dragCoeff"]),api}},{"ngraph.expose":8,"ngraph.merge":13}],19:[function(require,module,exports){function integrate(bodies,timeStep){var dx=0,tx=0,dy=0,ty=0,i,max=bodies.length;if(0===max)return 0;for(i=0;i<max;++i){var body=bodies[i],coeff=timeStep/body.mass;body.velocity.x+=coeff*body.force.x,body.velocity.y+=coeff*body.force.y;var vx=body.velocity.x,vy=body.velocity.y,v=Math.sqrt(vx*vx+vy*vy);v>1&&(body.velocity.x=vx/v,body.velocity.y=vy/v),dx=timeStep*body.velocity.x,dy=timeStep*body.velocity.y,body.pos.x+=dx,body.pos.y+=dy,tx+=Math.abs(dx),ty+=Math.abs(dy)}return(tx*tx+ty*ty)/max}module.exports=integrate},{}],20:[function(require,module,exports){function Spring(fromBody,toBody,length,coeff,weight){this.from=fromBody,this.to=toBody,this.length=length,this.coeff=coeff,this.weight="number"==typeof weight?weight:1}module.exports=Spring},{}],21:[function(require,module,exports){module.exports=function(options){var merge=require("ngraph.merge"),random=require("ngraph.random").random(42),expose,api={update:function(spring){var body1=spring.from,body2=spring.to,length=spring.length<0?options.springLength:spring.length,dx=body2.pos.x-body1.pos.x,dy=body2.pos.y-body1.pos.y,r=Math.sqrt(dx*dx+dy*dy);0===r&&(dx=(random.nextDouble()-.5)/50,dy=(random.nextDouble()-.5)/50,r=Math.sqrt(dx*dx+dy*dy));var d=r-length,coeff=(!spring.coeff||spring.coeff<0?options.springCoeff:spring.coeff)*d/r*spring.weight;body1.force.x+=coeff*dx,body1.force.y+=coeff*dy,body2.force.x-=coeff*dx,body2.force.y-=coeff*dy}};return require("ngraph.expose")(options=merge(options,{springCoeff:2e-4,springLength:80}),api,["springCoeff","springLength"]),api}},{"ngraph.expose":8,"ngraph.merge":13,"ngraph.random":26}],22:[function(require,module,exports){function getChild(node,idx){return 0===idx?node.quad0:1===idx?node.quad1:2===idx?node.quad2:3===idx?node.quad3:null}function setChild(node,idx,child){0===idx?node.quad0=child:1===idx?node.quad1=child:2===idx?node.quad2=child:3===idx&&(node.quad3=child)}module.exports=function(options){(options=options||{}).gravity="number"==typeof options.gravity?options.gravity:-1,options.theta="number"==typeof options.theta?options.theta:.8,options.force="object"==typeof options.force?options.force:{x:0,y:0};var random=require("ngraph.random").random(1984),Node=require("./node"),InsertStack=require("./insertStack"),isSamePosition=require("./isSamePosition"),gravity=options.gravity,updateQueue=[],insertStack=new InsertStack,theta=options.theta,force=options.force;return nodesCache=[],currentInCache=0,root=newNode(),{insertBodies:insertBodies,getRoot:function(){return root},updateBodyForce:update,options:function(newOptions){return newOptions?("number"==typeof newOptions.gravity&&(gravity=newOptions.gravity),"number"==typeof newOptions.theta&&(theta=newOptions.theta),"object"==typeof newOptions.force&&(force=newOptions.force),this):{gravity:gravity,theta:theta}}};function newNode(){var node=nodesCache[currentInCache];return node?(node.quad0=null,node.quad1=null,node.quad2=null,node.quad3=null,node.body=null,node.mass=node.massX=node.massY=0,node.left=node.right=node.top=node.bottom=0):(node=new Node,nodesCache[currentInCache]=node),++currentInCache,node}function update(sourceBody){var queue=updateQueue,v,dx,dy,r,fx=0,fy=0,queueLength=1,shiftIdx=0,pushIdx=1;for(queue[0]=root;queueLength;){var node=queue[shiftIdx],body=node.body;queueLength-=1,shiftIdx+=1;var differentBody=body!==sourceBody;body&&differentBody?(dx=body.pos.x-sourceBody.pos.x,dy=body.pos.y-sourceBody.pos.y,0===(r=Math.sqrt(dx*dx+dy*dy))&&(dx=(random.nextDouble()-.5)/50,dy=(random.nextDouble()-.5)/50,r=Math.sqrt(dx*dx+dy*dy)),fx+=(v=gravity*body.mass*sourceBody.mass/(r*r*r))*dx,fy+=v*dy):differentBody&&(dx=node.massX/node.mass-sourceBody.pos.x,dy=node.massY/node.mass-sourceBody.pos.y,0===(r=Math.sqrt(dx*dx+dy*dy))&&(dx=(random.nextDouble()-.5)/50,dy=(random.nextDouble()-.5)/50,r=Math.sqrt(dx*dx+dy*dy)),(node.right-node.left)/r<theta?(fx+=(v=gravity*node.mass*sourceBody.mass/(r*r*r))*dx,fy+=v*dy):(node.quad0&&(queue[pushIdx]=node.quad0,queueLength+=1,pushIdx+=1),node.quad1&&(queue[pushIdx]=node.quad1,queueLength+=1,pushIdx+=1),node.quad2&&(queue[pushIdx]=node.quad2,queueLength+=1,pushIdx+=1),node.quad3&&(queue[pushIdx]=node.quad3,queueLength+=1,pushIdx+=1)))}sourceBody.force.x+=fx+force.x/(.01*Math.abs(sourceBody.pos.x)+1),sourceBody.force.y+=fy+force.y/(.01*Math.abs(sourceBody.pos.y)+1)}function insertBodies(bodies){var x1=Number.MAX_VALUE,y1=Number.MAX_VALUE,x2=Number.MIN_VALUE,y2=Number.MIN_VALUE,i,max=bodies.length;for(i=max;i--;){var x=bodies[i].pos.x,y=bodies[i].pos.y;x<x1&&(x1=x),x>x2&&(x2=x),y<y1&&(y1=y),y>y2&&(y2=y)}var dx=x2-x1,dy=y2-y1;for(dx>dy?y2=y1+dx:x2=x1+dy,currentInCache=0,root=newNode(),root.left=x1,root.right=x2,root.top=y1,root.bottom=y2,(i=max-1)>=0&&(root.body=bodies[i]);i--;)insert(bodies[i],root)}function insert(newBody){for(insertStack.reset(),insertStack.push(root,newBody);!insertStack.isEmpty();){var stackItem=insertStack.pop(),node=stackItem.node,body=stackItem.body;if(node.body){var oldBody=node.body;if(node.body=null,isSamePosition(oldBody.pos,body.pos)){var retriesCount=3;do{var offset=random.nextDouble(),dx=(node.right-node.left)*offset,dy=(node.bottom-node.top)*offset;oldBody.pos.x=node.left+dx,oldBody.pos.y=node.top+dy,retriesCount-=1}while(retriesCount>0&&isSamePosition(oldBody.pos,body.pos));if(0===retriesCount&&isSamePosition(oldBody.pos,body.pos))return}insertStack.push(node,oldBody),insertStack.push(node,body)}else{var x=body.pos.x,y=body.pos.y;node.mass=node.mass+body.mass,node.massX=node.massX+body.mass*x,node.massY=node.massY+body.mass*y;var quadIdx=0,left=node.left,right=(node.right+left)/2,top=node.top,bottom=(node.bottom+top)/2;x>right&&(quadIdx+=1,left=right,right=node.right),y>bottom&&(quadIdx+=2,top=bottom,bottom=node.bottom);var child=getChild(node,quadIdx);child?insertStack.push(child,body):((child=newNode()).left=left,child.top=top,child.right=right,child.bottom=bottom,child.body=body,setChild(node,quadIdx,child))}}}}},{"./insertStack":23,"./isSamePosition":24,"./node":25,"ngraph.random":26}],23:[function(require,module,exports){function InsertStack(){this.stack=[],this.popIdx=0}function InsertStackElement(node,body){this.node=node,this.body=body}module.exports=InsertStack,InsertStack.prototype={isEmpty:function(){return 0===this.popIdx},push:function(node,body){var item=this.stack[this.popIdx];item?(item.node=node,item.body=body):this.stack[this.popIdx]=new InsertStackElement(node,body),++this.popIdx},pop:function(){if(this.popIdx>0)return this.stack[--this.popIdx]},reset:function(){this.popIdx=0}}},{}],24:[function(require,module,exports){module.exports=function isSamePosition(point1,point2){var dx=Math.abs(point1.x-point2.x),dy=Math.abs(point1.y-point2.y);return dx<1e-8&&dy<1e-8}},{}],25:[function(require,module,exports){module.exports=function Node(){this.body=null,this.quad0=null,this.quad1=null,this.quad2=null,this.quad3=null,this.mass=0,this.massX=0,this.massY=0,this.left=0,this.top=0,this.bottom=0,this.right=0}},{}],26:[function(require,module,exports){function random(inputSeed){var seed="number"==typeof inputSeed?inputSeed:+new Date,randomFunc=function(){return(268435455&(seed=4294967295&(3042594569^(seed=(seed=4294967295&((seed=(seed=4294967295&(3345072700^(seed=seed+2127912214+(seed<<12)&4294967295)^seed>>>19))+374761393+(seed<<5)&4294967295)+3550635116^seed<<9))+4251993797+(seed<<3)&4294967295)^seed>>>16)))/268435456};return{next:function(maxValue){return Math.floor(randomFunc()*maxValue)},nextDouble:function(){return randomFunc()}}}function randomIterator(array,customRandom){var localRandom=customRandom||random();if("function"!=typeof localRandom.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(callback){var i,j,t;for(i=array.length-1;i>0;--i)j=localRandom.next(i+1),t=array[j],array[j]=array[i],array[i]=t,callback(t);array.length&&callback(array[0])},shuffle:function(){var i,j,t;for(i=array.length-1;i>0;--i)j=localRandom.next(i+1),t=array[j],array[j]=array[i],array[i]=t;return array}}}module.exports={random:random,randomIterator:randomIterator}},{}],27:[function(require,module,exports){function save(graph,customNodeTransform,customLinkTransform){var result={nodes:[],links:[]},nodeTransform=customNodeTransform||defaultTransformForNode,linkTransform=customLinkTransform||defaultTransformForLink;return graph.forEachNode(saveNode),graph.forEachLink(saveLink),JSON.stringify(result);function saveNode(node){result.nodes.push(nodeTransform(node))}function saveLink(link){result.links.push(linkTransform(link))}function defaultTransformForNode(node){var result={id:node.id};return void 0!==node.data&&(result.data=node.data),result}function defaultTransformForLink(link){var result={fromId:link.fromId,toId:link.toId};return void 0!==link.data&&(result.data=link.data),result}}module.exports=save},{}],28:[function(require,module,exports){module.exports=svg,svg.compile=require("./lib/compile");var compileTemplate=svg.compileTemplate=require("./lib/compile_template"),domEvents=require("add-event-listener"),svgns="http://www.w3.org/2000/svg",xlinkns="http://www.w3.org/1999/xlink";function svg(element,attrBag){var svgElement=augment(element);if(void 0===attrBag)return svgElement;for(var attributes=Object.keys(attrBag),i=0;i<attributes.length;++i){var attributeName=attributes[i],value=attrBag[attributeName];"link"===attributeName?svgElement.link(value):svgElement.attr(attributeName,value)}return svgElement}function augment(element){var svgElement=element,compiledTempalte;if("string"==typeof element)svgElement=window.document.createElementNS(svgns,element);else if(element.simplesvg)return element;return svgElement.simplesvg=!0,svgElement.attr=attr,svgElement.append=append,svgElement.link=link,svgElement.text=text,svgElement.on=on,svgElement.off=off,svgElement.dataSource=dataSource,svgElement;function dataSource(model){return compiledTempalte||(compiledTempalte=compileTemplate(svgElement)),compiledTempalte.link(model),svgElement}function on(name,cb,useCapture){return domEvents.addEventListener(svgElement,name,cb,useCapture),svgElement}function off(name,cb,useCapture){return domEvents.removeEventListener(svgElement,name,cb,useCapture),svgElement}function append(content){var child=svg(content);return svgElement.appendChild(child),child}function attr(name,value){return 2===arguments.length?(null!==value?svgElement.setAttributeNS(null,name,value):svgElement.removeAttributeNS(null,name),svgElement):svgElement.getAttributeNS(null,name)}function link(target){return arguments.length?(svgElement.setAttributeNS(xlinkns,"xlink:href",target),svgElement):svgElement.getAttributeNS(xlinkns,"xlink:href")}function text(textContent){return void 0!==textContent?(svgElement.textContent=textContent,svgElement):svgElement.textContent}}},{"./lib/compile":29,"./lib/compile_template":30,"add-event-listener":2}],29:[function(require,module,exports){var parser=require("./domparser.js"),svg=require("../");function compile(svgText){try{return svgText=addNamespaces(svgText),svg(parser.parseFromString(svgText,"text/xml").documentElement)}catch(e){throw e}}function addNamespaces(text){if(text){var namespaces='xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"',match=text.match(/^<\w+/);if(match){var tagLength=match[0].length;return text.substr(0,tagLength)+" "+namespaces+" "+text.substr(tagLength)}throw new Error("Cannot parse input text: invalid xml?")}}module.exports=compile},{"../":28,"./domparser.js":31}],30:[function(require,module,exports){module.exports=template;var BINDING_EXPR=/{{(.+?)}}/;function template(domNode){var allBindings=Object.create(null);return extractAllBindings(domNode,allBindings),{link:function(model){function changeModel(setter){setter(model)}Object.keys(allBindings).forEach(function(key){var setter;allBindings[key].forEach(changeModel)})}}}function extractAllBindings(domNode,allBindings){var nodeType=domNode.nodeType,typeSupported;if(1===nodeType||3===nodeType){var i;if(domNode.hasChildNodes()){var domChildren=domNode.childNodes;for(i=0;i<domChildren.length;++i)extractAllBindings(domChildren[i],allBindings)}if(3===nodeType&&bindTextContent(domNode,allBindings),domNode.attributes){var attrs=domNode.attributes;for(i=0;i<attrs.length;++i)bindDomAttribute(attrs[i],domNode,allBindings)}}}function bindDomAttribute(domAttribute,element,allBindings){var value=domAttribute.value;if(value){var modelNameMatch=value.match(BINDING_EXPR);if(modelNameMatch){var attrName=domAttribute.localName,modelPropertyName=modelNameMatch[1],isSimpleValue;if(!(modelPropertyName.indexOf(".")<0))throw new Error("simplesvg currently does not support nested bindings");var propertyBindings=allBindings[modelPropertyName];propertyBindings?propertyBindings.push(attributeSetter):propertyBindings=allBindings[modelPropertyName]=[attributeSetter]}}function attributeSetter(model){element.setAttributeNS(null,attrName,model[modelPropertyName])}}function bindTextContent(element,allBindings){var value=element.nodeValue;if(value){var modelNameMatch=value.match(BINDING_EXPR);if(modelNameMatch){var modelPropertyName=modelNameMatch[1],isSimpleValue=modelPropertyName.indexOf(".")<0,propertyBindings=allBindings[modelPropertyName];propertyBindings?propertyBindings.push(textSetter):propertyBindings=allBindings[modelPropertyName]=[textSetter]}}function textSetter(model){element.nodeValue=model[modelPropertyName]}}},{}],31:[function(require,module,exports){function createDomparser(){return"undefined"==typeof DOMParser?{parseFromString:fail}:new DOMParser}function fail(){throw new Error("DOMParser is not supported by this platform. Please open issue here https://github.com/anvaka/simplesvg")}module.exports=createDomparser()},{}],32:[function(require,module,exports){var centrality=require("ngraph.centrality");function centralityWrapper(){return{betweennessCentrality:betweennessCentrality,degreeCentrality:degreeCentrality}}function betweennessCentrality(g){var betweenness;return toVivaGraphCentralityFormat(centrality.betweenness(g))}function degreeCentrality(g,kind){var degree;return toVivaGraphCentralityFormat(centrality.degree(g,kind))}function toVivaGraphCentralityFormat(centrality){return Object.keys(centrality).sort(byValue).map(toKeyValue);function byValue(x,y){return centrality[y]-centrality[x]}function toKeyValue(key){return{key:key,value:centrality[key]}}}module.exports=centralityWrapper},{"ngraph.centrality":4}],33:[function(require,module,exports){function operations(){return{density:function(graph,directed){var nodes=graph.getNodesCount();return 0===nodes?NaN:directed?graph.getLinksCount()/(nodes*(nodes-1)):2*graph.getLinksCount()/(nodes*(nodes-1))}}}module.exports=operations},{}],34:[function(require,module,exports){module.exports=domInputManager;var dragndrop=require("./dragndrop.js");function domInputManager(graph,graphics){var nodeEvents={};return{bindDragNDrop:bindDragNDrop};function bindDragNDrop(node,handlers){var events;if(handlers){var nodeUI=graphics.getNodeUI(node.id);events=dragndrop(nodeUI),"function"==typeof handlers.onStart&&events.onStart(handlers.onStart),"function"==typeof handlers.onDrag&&events.onDrag(handlers.onDrag),"function"==typeof handlers.onStop&&events.onStop(handlers.onStop),nodeEvents[node.id]=events}else(events=nodeEvents[node.id])&&(events.release(),delete nodeEvents[node.id])}}},{"./dragndrop.js":35}],35:[function(require,module,exports){module.exports=dragndrop;var documentEvents=require("../Utils/documentEvents.js"),browserInfo=require("../Utils/browserInfo.js"),findElementPosition=require("../Utils/findElementPosition.js");function dragndrop(element){var start,drag,end,scroll,prevSelectStart,prevDragStart,startX=0,startY=0,dragObject,touchInProgress=!1,pinchZoomLength=0,getMousePos=function(e){var posx=0,posy=0;return(e=e||window.event).pageX||e.pageY?(posx=e.pageX,posy=e.pageY):(e.clientX||e.clientY)&&(posx=e.clientX+window.document.body.scrollLeft+window.document.documentElement.scrollLeft,posy=e.clientY+window.document.body.scrollTop+window.document.documentElement.scrollTop),[posx,posy]},move=function(e,clientX,clientY){drag&&drag(e,{x:clientX-startX,y:clientY-startY}),startX=clientX,startY=clientY},stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault=function(e){e.preventDefault&&e.preventDefault()},handleDisabledEvent=function(e){return stopPropagation(e),!1},handleMouseMove=function(e){e=e||window.event,move(e,e.clientX,e.clientY)},handleMouseDown=function(e){return e=e||window.event,touchInProgress?(stopPropagation(e),!1):1===e.button&&null!==window.event||0===e.button?(startX=e.clientX,startY=e.clientY,dragObject=e.target||e.srcElement,start&&start(e,{x:startX,y:startY}),documentEvents.on("mousemove",handleMouseMove),documentEvents.on("mouseup",handleMouseUp),stopPropagation(e),prevSelectStart=window.document.onselectstart,prevDragStart=window.document.ondragstart,window.document.onselectstart=handleDisabledEvent,dragObject.ondragstart=handleDisabledEvent,!1):void 0;var isLeftButton},handleMouseUp=function(e){e=e||window.event,documentEvents.off("mousemove",handleMouseMove),documentEvents.off("mouseup",handleMouseUp),window.document.onselectstart=prevSelectStart,dragObject.ondragstart=prevDragStart,dragObject=null,end&&end(e)},handleMouseWheel=function(e){if("function"==typeof scroll){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1;var delta,mousePos=getMousePos(e),elementOffset=findElementPosition(element),relMousePos={x:mousePos[0]-elementOffset[0],y:mousePos[1]-elementOffset[1]};delta=e.wheelDelta?e.wheelDelta/360:e.detail/-9,scroll(e,delta,relMousePos)}},updateScrollEvents=function(scrollCallback){!scroll&&scrollCallback?"webkit"===browserInfo.browser?element.addEventListener("mousewheel",handleMouseWheel,!1):element.addEventListener("DOMMouseScroll",handleMouseWheel,!1):scroll&&!scrollCallback&&("webkit"===browserInfo.browser?element.removeEventListener("mousewheel",handleMouseWheel,!1):element.removeEventListener("DOMMouseScroll",handleMouseWheel,!1)),scroll=scrollCallback},getPinchZoomLength=function(finger1,finger2){return(finger1.clientX-finger2.clientX)*(finger1.clientX-finger2.clientX)+(finger1.clientY-finger2.clientY)*(finger1.clientY-finger2.clientY)},handleTouchMove=function(e){if(1===e.touches.length){stopPropagation(e);var touch=e.touches[0];move(e,touch.clientX,touch.clientY)}else if(2===e.touches.length){var currentPinchLength=getPinchZoomLength(e.touches[0],e.touches[1]),delta=0;currentPinchLength<pinchZoomLength?delta=-1:currentPinchLength>pinchZoomLength&&(delta=1),scroll(e,delta,{x:e.touches[0].clientX,y:e.touches[0].clientY}),pinchZoomLength=currentPinchLength,stopPropagation(e),preventDefault(e)}},handleTouchEnd=function(e){touchInProgress=!1,documentEvents.off("touchmove",handleTouchMove),documentEvents.off("touchend",handleTouchEnd),documentEvents.off("touchcancel",handleTouchEnd),dragObject=null,end&&end(e)},handleSignleFingerTouch=function(e,touch){stopPropagation(e),preventDefault(e),startX=touch.clientX,startY=touch.clientY,dragObject=e.target||e.srcElement,start&&start(e,{x:startX,y:startY}),touchInProgress||(touchInProgress=!0,documentEvents.on("touchmove",handleTouchMove),documentEvents.on("touchend",handleTouchEnd),documentEvents.on("touchcancel",handleTouchEnd))},handleTouchStart=function(e){if(1===e.touches.length)return handleSignleFingerTouch(e,e.touches[0]);2===e.touches.length&&(stopPropagation(e),preventDefault(e),pinchZoomLength=getPinchZoomLength(e.touches[0],e.touches[1]))};return element.addEventListener("mousedown",handleMouseDown),element.addEventListener("touchstart",handleTouchStart),{onStart:function(callback){return start=callback,this},onDrag:function(callback){return drag=callback,this},onStop:function(callback){return end=callback,this},onScroll:function(callback){return updateScrollEvents(callback),this},release:function(){element.removeEventListener("mousedown",handleMouseDown),element.removeEventListener("touchstart",handleTouchStart),documentEvents.off("mousemove",handleMouseMove),documentEvents.off("mouseup",handleMouseUp),documentEvents.off("touchmove",handleTouchMove),documentEvents.off("touchend",handleTouchEnd),documentEvents.off("touchcancel",handleTouchEnd),updateScrollEvents(null)}}}},{"../Utils/browserInfo.js":39,"../Utils/documentEvents.js":40,"../Utils/findElementPosition.js":41}],36:[function(require,module,exports){module.exports=webglInputManager;var createInputEvents=require("../WebGL/webglInputEvents.js");function webglInputManager(graph,graphics){var inputEvents=createInputEvents(graphics),draggedNode=null,internalHandlers={},pos={x:0,y:0};return inputEvents.mouseDown(function(node,e){draggedNode=node,pos.x=e.clientX,pos.y=e.clientY,inputEvents.mouseCapture(draggedNode);var handlers=internalHandlers[node.id];return handlers&&handlers.onStart&&handlers.onStart(e,pos),!0}).mouseUp(function(node){inputEvents.releaseMouseCapture(draggedNode),draggedNode=null;var handlers=internalHandlers[node.id];return handlers&&handlers.onStop&&handlers.onStop(),!0}).mouseMove(function(node,e){if(draggedNode){var handlers=internalHandlers[draggedNode.id];return handlers&&handlers.onDrag&&handlers.onDrag(e,{x:e.clientX-pos.x,y:e.clientY-pos.y}),pos.x=e.clientX,pos.y=e.clientY,!0}}),{bindDragNDrop:function(node,handlers){internalHandlers[node.id]=handlers,handlers||delete internalHandlers[node.id]}}}},{"../WebGL/webglInputEvents.js":57}],37:[function(require,module,exports){module.exports=constant;var merge=require("ngraph.merge"),random=require("ngraph.random").random,Rect=require("../Utils/rect.js");function constant(graph,userSettings){userSettings=merge(userSettings,{maxX:1024,maxY:1024,seed:"Deterministic randomness made me do this"});var rand=random(userSettings.seed),graphRect=new Rect(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),layoutLinks={},placeNodeCallback=function(node){return{x:rand.next(userSettings.maxX),y:rand.next(userSettings.maxY)}},updateGraphRect=function(position,graphRect){position.x<graphRect.x1&&(graphRect.x1=position.x),position.x>graphRect.x2&&(graphRect.x2=position.x),position.y<graphRect.y1&&(graphRect.y1=position.y),position.y>graphRect.y2&&(graphRect.y2=position.y)},layoutNodes="function"==typeof Object.create?Object.create(null):{},ensureNodeInitialized=function(node){layoutNodes[node.id]=placeNodeCallback(node),updateGraphRect(layoutNodes[node.id],graphRect)},updateNodePositions=function(){0!==graph.getNodesCount()&&(graphRect.x1=Number.MAX_VALUE,graphRect.y1=Number.MAX_VALUE,graphRect.x2=Number.MIN_VALUE,graphRect.y2=Number.MIN_VALUE,graph.forEachNode(ensureNodeInitialized))},ensureLinkInitialized=function(link){layoutLinks[link.id]=link},onGraphChanged=function(changes){for(var i=0;i<changes.length;++i){var change=changes[i];change.node&&("add"===change.changeType?ensureNodeInitialized(change.node):delete layoutNodes[change.node.id]),change.link&&("add"===change.changeType?ensureLinkInitialized(change.link):delete layoutLinks[change.link.id])}};return graph.forEachNode(ensureNodeInitialized),graph.forEachLink(ensureLinkInitialized),graph.on("changed",onGraphChanged),{run:function(iterationsCount){this.step()},step:function(){return updateNodePositions(),!0},getGraphRect:function(){return graphRect},dispose:function(){graph.off("change",onGraphChanged)},isNodePinned:function(node){return!0},pinNode:function(node,isPinned){},getNodePosition:getNodePosition,getLinkPosition:function(linkId){var link=layoutLinks[linkId];return{from:getNodePosition(link.fromId),to:getNodePosition(link.toId)}},setNodePosition:function(nodeId,x,y){var pos=layoutNodes[nodeId];pos&&(pos.x=x,pos.y=y)},placeNode:function(newPlaceNodeCallbackOrNode){return"function"==typeof newPlaceNodeCallbackOrNode?(placeNodeCallback=newPlaceNodeCallbackOrNode,updateNodePositions(),this):placeNodeCallback(newPlaceNodeCallbackOrNode)}};function getNodePosition(nodeId){return layoutNodes[nodeId]}}},{"../Utils/rect.js":45,"ngraph.merge":13,"ngraph.random":26}],38:[function(require,module,exports){var events=require("ngraph.events");function backwardCompatibleEvents(g){return console.log("This method is deprecated. Please use Viva.events() instead"),g?void 0!==g.on||void 0!==g.off||void 0!==g.fire?{extend:function(){return g},on:g.on,stop:g.off}:{extend:extend,on:g.on,stop:g.off}:g;var eventsDefined;function extend(){var backwardCompatible=events(g);return backwardCompatible.addEventListener=backwardCompatible.on,backwardCompatible}}module.exports=backwardCompatibleEvents},{"ngraph.events":7}],39:[function(require,module,exports){function browserInfo(){if("undefined"==typeof window||!window.hasOwnProperty("navigator"))return{browser:"",version:"0"};var ua=window.navigator.userAgent.toLowerCase(),rwebkit,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,match=/(webkit)[ \/]([\w.]+)/.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}}module.exports=browserInfo()},{}],40:[function(require,module,exports){var nullEvents=require("./nullEvents.js");function createDocumentEvents(){return void 0===typeof document?nullEvents:{on:on,off:off}}function on(eventName,handler){document.addEventListener(eventName,handler)}function off(eventName,handler){document.removeEventListener(eventName,handler)}module.exports=createDocumentEvents()},{"./nullEvents.js":44}],41:[function(require,module,exports){function findElementPosition(obj){var curleft=0,curtop=0;if(obj.offsetParent)do{curleft+=obj.offsetLeft,curtop+=obj.offsetTop}while(null!==(obj=obj.offsetParent));return[curleft,curtop]}module.exports=findElementPosition},{}],42:[function(require,module,exports){function getDimension(container){if(!container)throw{message:"Cannot get dimensions of undefined container"};var width,height;return{left:0,top:0,width:container.clientWidth,height:container.clientHeight}}module.exports=getDimension},{}],43:[function(require,module,exports){var intersect=require("gintersect");function intersectRect(left,top,right,bottom,x1,y1,x2,y2){return intersect(left,top,left,bottom,x1,y1,x2,y2)||intersect(left,bottom,right,bottom,x1,y1,x2,y2)||intersect(right,bottom,right,top,x1,y1,x2,y2)||intersect(right,top,left,top,x1,y1,x2,y2)}module.exports=intersectRect},{gintersect:3}],44:[function(require,module,exports){function createNullEvents(){return{on:noop,off:noop,stop:noop}}function noop(){}module.exports=createNullEvents()},{}],45:[function(require,module,exports){function Rect(x1,y1,x2,y2){this.x1=x1||0,this.y1=y1||0,this.x2=x2||0,this.y2=y2||0}module.exports=Rect},{}],46:[function(require,module,exports){(function(global){function createTimer(){var lastTime=0,vendors=["ms","moz","webkit","o"],i,scope;for(scope="undefined"!=typeof window?window:void 0!==global?global:{setTimeout:noop,clearTimeout:noop},i=0;i<vendors.length&&!scope.requestAnimationFrame;++i){var vendorPrefix=vendors[i];scope.requestAnimationFrame=scope[vendorPrefix+"RequestAnimationFrame"],scope.cancelAnimationFrame=scope[vendorPrefix+"CancelAnimationFrame"]||scope[vendorPrefix+"CancelRequestAnimationFrame"]}return scope.requestAnimationFrame||(scope.requestAnimationFrame=rafPolyfill),scope.cancelAnimationFrame||(scope.cancelAnimationFrame=cancelRafPolyfill),timer;function timer(callback){var intervalId;return startTimer(),{stop:stopTimer,restart:restart};function startTimer(){intervalId=scope.requestAnimationFrame(startTimer),callback()||stopTimer()}function stopTimer(){scope.cancelAnimationFrame(intervalId),intervalId=0}function restart(){intervalId||startTimer()}}function rafPolyfill(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=scope.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}function cancelRafPolyfill(id){scope.clearTimeout(id)}}function noop(){}module.exports=createTimer()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],47:[function(require,module,exports){var nullEvents=require("./nullEvents.js");function createDocumentEvents(){return"undefined"==typeof window?nullEvents:{on:on,off:off}}function on(eventName,handler){window.addEventListener(eventName,handler)}function off(eventName,handler){window.removeEventListener(eventName,handler)}module.exports=createDocumentEvents()},{"./nullEvents.js":44}],48:[function(require,module,exports){module.exports=renderer;var eventify=require("ngraph.events"),forceDirected=require("ngraph.forcelayout"),svgGraphics=require("./svgGraphics.js"),windowEvents=require("../Utils/windowEvents.js"),domInputManager=require("../Input/domInputManager.js"),timer=require("../Utils/timer.js"),getDimension=require("../Utils/getDimensions.js"),dragndrop=require("../Input/dragndrop.js");function renderer(graph,settings){var FRAME_INTERVAL=30,layout=(settings=settings||{}).layout,graphics=settings.graphics,container=settings.container,interactive=void 0===settings.interactive||settings.interactive,inputManager,animationTimer,rendererInitialized=!1,updateCenterRequired=!0,currentStep=0,totalIterationsCount=0,isStable=!1,userInteraction=!1,isPaused=!1,transform={offsetX:0,offsetY:0,scale:1},publicEvents=eventify({}),containerDrag;return{run:function(iterationsCount){return rendererInitialized||(prepareSettings(),prerender(),initDom(),updateCenter(),listenToEvents(),rendererInitialized=!0),renderIterations(iterationsCount),this},reset:function(){graphics.resetScale(),updateCenter(),transform.scale=1},pause:function(){isPaused=!0,animationTimer.stop()},resume:function(){isPaused=!1,animationTimer.restart()},rerender:function(){return renderGraph(),this},zoomOut:function(){return scale(!0)},zoomIn:function(){return scale(!1)},moveTo:function(x,y){graphics.graphCenterChanged(transform.offsetX-x*transform.scale,transform.offsetY-y*transform.scale),renderGraph()},getGraphics:function(){return graphics},dispose:function(){stopListenToEvents()},on:function(eventName,callback){return publicEvents.on(eventName,callback),this},off:function(eventName,callback){return publicEvents.off(eventName,callback),this}};function isInteractive(interactionName){return"string"==typeof interactive?interactive.indexOf(interactionName)>=0:"boolean"!=typeof interactive||interactive}function prepareSettings(){container=container||window.document.body,layout=layout||forceDirected(graph,{springLength:80,springCoeff:2e-4}),graphics=graphics||svgGraphics(graph,{container:container}),settings.hasOwnProperty("renderLinks")||(settings.renderLinks=!0),settings.prerender=settings.prerender||0,inputManager=(graphics.inputManager||domInputManager)(graph,graphics)}function renderGraph(){graphics.beginRender(),settings.renderLinks&&graphics.renderLinks(),graphics.renderNodes(),graphics.endRender()}function onRenderFrame(){return isStable=layout.step()&&!userInteraction,renderGraph(),!isStable}function renderIterations(iterationsCount){animationTimer?totalIterationsCount+=iterationsCount:iterationsCount?(totalIterationsCount+=iterationsCount,animationTimer=timer(function(){return onRenderFrame()},FRAME_INTERVAL)):(currentStep=0,totalIterationsCount=0,animationTimer=timer(onRenderFrame,FRAME_INTERVAL))}function resetStable(){isPaused||(isStable=!1,animationTimer.restart())}function prerender(){if("number"==typeof settings.prerender&&settings.prerender>0)for(var i=0;i<settings.prerender;i+=1)layout.step()}function updateCenter(){var graphRect=layout.getGraphRect(),containerSize=getDimension(container),cx=(graphRect.x2+graphRect.x1)/2,cy=(graphRect.y2+graphRect.y1)/2;transform.offsetX=containerSize.width/2-(cx*transform.scale-cx),transform.offsetY=containerSize.height/2-(cy*transform.scale-cy),graphics.graphCenterChanged(transform.offsetX,transform.offsetY),updateCenterRequired=!1}function createNodeUi(node){var nodePosition=layout.getNodePosition(node.id);graphics.addNode(node,nodePosition)}function removeNodeUi(node){graphics.releaseNode(node)}function createLinkUi(link){var linkPosition=layout.getLinkPosition(link.id);graphics.addLink(link,linkPosition)}function removeLinkUi(link){graphics.releaseLink(link)}function listenNodeEvents(node){if(isInteractive("node")){var wasPinned=!1;inputManager.bindDragNDrop(node,{onStart:function(){wasPinned=layout.isNodePinned(node),layout.pinNode(node,!0),userInteraction=!0,resetStable()},onDrag:function(e,offset){var oldPos=layout.getNodePosition(node.id);layout.setNodePosition(node.id,oldPos.x+offset.x/transform.scale,oldPos.y+offset.y/transform.scale),userInteraction=!0,renderGraph()},onStop:function(){layout.pinNode(node,wasPinned),userInteraction=!1}})}}function releaseNodeEvents(node){inputManager.bindDragNDrop(node,null)}function initDom(){graphics.init(container),graph.forEachNode(createNodeUi),settings.renderLinks&&graph.forEachLink(createLinkUi)}function releaseDom(){graphics.release(container)}function processNodeChange(change){var node=change.node;"add"===change.changeType?(createNodeUi(node),listenNodeEvents(node),updateCenterRequired&&updateCenter()):"remove"===change.changeType?(releaseNodeEvents(node),removeNodeUi(node),0===graph.getNodesCount()&&(updateCenterRequired=!0)):"update"===change.changeType&&(releaseNodeEvents(node),removeNodeUi(node),createNodeUi(node),listenNodeEvents(node))}function processLinkChange(change){var link=change.link;if("add"===change.changeType)settings.renderLinks&&createLinkUi(link);else if("remove"===change.changeType)settings.renderLinks&&removeLinkUi(link);else if("update"===change.changeType)throw"Update type is not implemented. TODO: Implement me!"}function onGraphChanged(changes){var i,change;for(i=0;i<changes.length;i+=1)(change=changes[i]).node?processNodeChange(change):change.link&&processLinkChange(change);resetStable()}function onWindowResized(){updateCenter(),onRenderFrame()}function releaseContainerDragManager(){containerDrag&&(containerDrag.release(),containerDrag=null)}function releaseGraphEvents(){graph.off("changed",onGraphChanged)}function scale(out,scrollPoint){if(!scrollPoint){var containerSize=getDimension(container);scrollPoint={x:containerSize.width/2,y:containerSize.height/2}}var scaleFactor=Math.pow(1.4,out?-.2:.2);return transform.scale=graphics.scale(scaleFactor,scrollPoint),renderGraph(),publicEvents.fire("scale",transform.scale),transform.scale}function listenToEvents(){windowEvents.on("resize",onWindowResized),releaseContainerDragManager(),isInteractive("drag")&&(containerDrag=dragndrop(container)).onDrag(function(e,offset){graphics.translateRel(offset.x,offset.y),renderGraph(),publicEvents.fire("drag",offset)}),isInteractive("scroll")&&(containerDrag||(containerDrag=dragndrop(container)),containerDrag.onScroll(function(e,scaleOffset,scrollPoint){scale(scaleOffset<0,scrollPoint)})),graph.forEachNode(listenNodeEvents),releaseGraphEvents(),graph.on("changed",onGraphChanged)}function stopListenToEvents(){rendererInitialized=!1,releaseGraphEvents(),releaseContainerDragManager(),windowEvents.off("resize",onWindowResized),publicEvents.off(),animationTimer.stop(),graph.forEachLink(function(link){settings.renderLinks&&removeLinkUi(link)}),graph.forEachNode(function(node){releaseNodeEvents(node),removeNodeUi(node)}),layout.dispose(),releaseDom()}}},{"../Input/domInputManager.js":34,"../Input/dragndrop.js":35,"../Utils/getDimensions.js":42,"../Utils/timer.js":46,"../Utils/windowEvents.js":47,"./svgGraphics.js":49,"ngraph.events":7,"ngraph.forcelayout":9}],49:[function(require,module,exports){module.exports=svgGraphics;var svg=require("simplesvg"),eventify=require("ngraph.events"),domInputManager=require("../Input/domInputManager.js");function svgGraphics(){var svgContainer,svgRoot,offsetX=0,offsetY=0,initCallback,actualScale=1,allNodes={},allLinks={},nodeBuilder=function(node){return svg("rect").attr("width",10).attr("height",10).attr("fill","#00a2e8")},nodePositionCallback=function(nodeUI,pos){nodeUI.attr("x",pos.x-5).attr("y",pos.y-5)},linkBuilder=function(link){return svg("line").attr("stroke","#999")},linkPositionCallback=function(linkUI,fromPos,toPos){linkUI.attr("x1",fromPos.x).attr("y1",fromPos.y).attr("x2",toPos.x).attr("y2",toPos.y)},fireRescaled=function(graphics){graphics.fire("rescaled")},cachedPos={x:0,y:0},cachedFromPos={x:0,y:0},cachedToPos={x:0,y:0},updateTransform=function(){if(svgContainer){var transform="matrix("+actualScale+", 0, 0,"+actualScale+","+offsetX+","+offsetY+")";svgContainer.attr("transform",transform)}};svgRoot=createSvgRoot();var graphics={getNodeUI:function(nodeId){return allNodes[nodeId]},getLinkUI:function(linkId){return allLinks[linkId]},node:function(builderCallback){if("function"==typeof builderCallback)return nodeBuilder=builderCallback,this},link:function(builderCallback){if("function"==typeof builderCallback)return linkBuilder=builderCallback,this},placeNode:function(newPlaceCallback){return nodePositionCallback=newPlaceCallback,this},placeLink:function(newPlaceLinkCallback){return linkPositionCallback=newPlaceLinkCallback,this},beginRender:function(){},endRender:function(){},graphCenterChanged:function(x,y){offsetX=x,offsetY=y,updateTransform()},inputManager:domInputManager,translateRel:function(dx,dy){var p=svgRoot.createSVGPoint(),t=svgContainer.getCTM(),origin=svgRoot.createSVGPoint().matrixTransform(t.inverse());p.x=dx,p.y=dy,(p=p.matrixTransform(t.inverse())).x=(p.x-origin.x)*t.a,p.y=(p.y-origin.y)*t.d,t.e+=p.x,t.f+=p.y;var transform="matrix("+t.a+", 0, 0,"+t.d+","+t.e+","+t.f+")";svgContainer.attr("transform",transform)},scale:function(scaleFactor,scrollPoint){var p=svgRoot.createSVGPoint();p.x=scrollPoint.x,p.y=scrollPoint.y,p=p.matrixTransform(svgContainer.getCTM().inverse());var k=svgRoot.createSVGMatrix().translate(p.x,p.y).scale(scaleFactor).translate(-p.x,-p.y),t=svgContainer.getCTM().multiply(k);actualScale=t.a,offsetX=t.e,offsetY=t.f;var transform="matrix("+t.a+", 0, 0,"+t.d+","+t.e+","+t.f+")";return svgContainer.attr("transform",transform),fireRescaled(this),actualScale},resetScale:function(){actualScale=1;var transform="matrix(1, 0, 0, 1, 0, 0)";return svgContainer.attr("transform",transform),fireRescaled(this),this},init:function(container){container.appendChild(svgRoot),updateTransform(),"function"==typeof initCallback&&initCallback(svgRoot)},release:function(container){svgRoot&&container&&container.removeChild(svgRoot)},addLink:function(link,pos){var linkUI=linkBuilder(link);if(linkUI)return linkUI.position=pos,linkUI.link=link,allLinks[link.id]=linkUI,svgContainer.childElementCount>0?svgContainer.insertBefore(linkUI,svgContainer.firstChild):svgContainer.appendChild(linkUI),linkUI},releaseLink:function(link){var linkUI=allLinks[link.id];linkUI&&(svgContainer.removeChild(linkUI),delete allLinks[link.id])},addNode:function(node,pos){var nodeUI=nodeBuilder(node);if(nodeUI)return nodeUI.position=pos,nodeUI.node=node,allNodes[node.id]=nodeUI,svgContainer.appendChild(nodeUI),nodeUI},releaseNode:function(node){var nodeUI=allNodes[node.id];nodeUI&&(svgContainer.removeChild(nodeUI),delete allNodes[node.id])},renderNodes:function(){for(var key in allNodes)if(allNodes.hasOwnProperty(key)){var nodeUI=allNodes[key];cachedPos.x=nodeUI.position.x,cachedPos.y=nodeUI.position.y,nodePositionCallback(nodeUI,cachedPos,nodeUI.node)}},renderLinks:function(){for(var key in allLinks)if(allLinks.hasOwnProperty(key)){var linkUI=allLinks[key];cachedFromPos.x=linkUI.position.from.x,cachedFromPos.y=linkUI.position.from.y,cachedToPos.x=linkUI.position.to.x,cachedToPos.y=linkUI.position.to.y,linkPositionCallback(linkUI,cachedFromPos,cachedToPos,linkUI.link)}},getGraphicsRoot:function(callbackWhenReady){return"function"==typeof callbackWhenReady&&(svgRoot?callbackWhenReady(svgRoot):initCallback=callbackWhenReady),svgRoot},getSvgRoot:function(){return svgRoot}};return eventify(graphics),graphics;function createSvgRoot(){var svgRoot=svg("svg");return svgContainer=svg("g").attr("buffered-rendering","dynamic"),svgRoot.appendChild(svgContainer),svgRoot}}},{"../Input/domInputManager.js":34,"ngraph.events":7,simplesvg:28}],50:[function(require,module,exports){module.exports=webglGraphics;var webglInputManager=require("../Input/webglInputManager.js"),webglLinkProgram=require("../WebGL/webglLinkProgram.js"),webglNodeProgram=require("../WebGL/webglNodeProgram.js"),webglSquare=require("../WebGL/webglSquare.js"),webglLine=require("../WebGL/webglLine.js"),eventify=require("ngraph.events"),merge=require("ngraph.merge");function webglGraphics(options){options=merge(options,{enableBlending:!0,preserveDrawingBuffer:!1,clearColor:!1,clearColorValue:{r:1,g:1,b:1,a:1}});var container,graphicsRoot,gl,width,height,nodesCount=0,linksCount=0,transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],userPlaceNodeCallback,userPlaceLinkCallback,nodes=[],links=[],initCallback,allNodes={},allLinks={},linkProgram=webglLinkProgram(),nodeProgram=webglNodeProgram(),nodeUIBuilder=function(node){return webglSquare()},linkUIBuilder=function(link){return webglLine(3014898687)},updateTransformUniform=function(){linkProgram.updateTransform(transform),nodeProgram.updateTransform(transform)},resetScaleInternal=function(){transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},updateSize=function(){container&&graphicsRoot&&(width=graphicsRoot.width=Math.max(container.offsetWidth,1),height=graphicsRoot.height=Math.max(container.offsetHeight,1),gl&&gl.viewport(0,0,width,height),linkProgram&&linkProgram.updateSize(width/2,height/2),nodeProgram&&nodeProgram.updateSize(width/2,height/2))},fireRescaled=function(graphics){graphics.fire("rescaled")};graphicsRoot=window.document.createElement("canvas");var graphics={getLinkUI:function(linkId){return allLinks[linkId]},getNodeUI:function(nodeId){return allNodes[nodeId]},node:function(builderCallback){if("function"==typeof builderCallback)return nodeUIBuilder=builderCallback,this},link:function(builderCallback){if("function"==typeof builderCallback)return linkUIBuilder=builderCallback,this},placeNode:function(newPlaceCallback){return userPlaceNodeCallback=newPlaceCallback,this},placeLink:function(newPlaceLinkCallback){return userPlaceLinkCallback=newPlaceLinkCallback,this},inputManager:webglInputManager,beginRender:function(){},endRender:function(){linksCount>0&&linkProgram.render(),nodesCount>0&&nodeProgram.render()},bringLinkToFront:function(linkUI){var frontLinkId=linkProgram.getFrontLinkId(),srcLinkId,temp;linkProgram.bringToFront(linkUI),frontLinkId>linkUI.id&&(srcLinkId=linkUI.id,temp=links[frontLinkId],links[frontLinkId]=links[srcLinkId],links[frontLinkId].id=frontLinkId,links[srcLinkId]=temp,links[srcLinkId].id=srcLinkId)},graphCenterChanged:function(x,y){transform[12]=2*x/width-1,transform[13]=1-2*y/height,updateTransformUniform()},addLink:function(link,boundPosition){var uiid=linksCount++,ui=linkUIBuilder(link);return ui.id=uiid,ui.pos=boundPosition,linkProgram.createLink(ui),links[uiid]=ui,allLinks[link.id]=ui,ui},addNode:function(node,boundPosition){var uiid=nodesCount++,ui=nodeUIBuilder(node);return ui.id=uiid,ui.position=boundPosition,ui.node=node,nodeProgram.createNode(ui),nodes[uiid]=ui,allNodes[node.id]=ui,ui},translateRel:function(dx,dy){transform[12]+=2*transform[0]*dx/width/transform[0],transform[13]-=2*transform[5]*dy/height/transform[5],updateTransformUniform()},scale:function(scaleFactor,scrollPoint){var cx=2*scrollPoint.x/width-1,cy=1-2*scrollPoint.y/height;return cx-=transform[12],cy-=transform[13],transform[12]+=cx*(1-scaleFactor),transform[13]+=cy*(1-scaleFactor),transform[0]*=scaleFactor,transform[5]*=scaleFactor,updateTransformUniform(),fireRescaled(this),transform[0]},resetScale:function(){return resetScaleInternal(),gl&&(updateSize(),updateTransformUniform()),this},updateSize:updateSize,init:function(c){var contextParameters={};if(options.preserveDrawingBuffer&&(contextParameters.preserveDrawingBuffer=!0),container=c,updateSize(),resetScaleInternal(),container.appendChild(graphicsRoot),!(gl=graphicsRoot.getContext("experimental-webgl",contextParameters))){var msg="Could not initialize WebGL. Seems like the browser doesn't support it.";throw window.alert(msg),msg}if(options.enableBlending&&(gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND)),options.clearColor){var color=options.clearColorValue;gl.clearColor(color.r,color.g,color.b,color.a),this.beginRender=function(){gl.clear(gl.COLOR_BUFFER_BIT)}}linkProgram.load(gl),linkProgram.updateSize(width/2,height/2),nodeProgram.load(gl),nodeProgram.updateSize(width/2,height/2),updateTransformUniform(),"function"==typeof initCallback&&initCallback(graphicsRoot)},release:function(container){graphicsRoot&&container&&container.removeChild(graphicsRoot)},isSupported:function(){var c=window.document.createElement("canvas"),gl;return c&&c.getContext&&c.getContext("experimental-webgl")},releaseLink:function(link){linksCount>0&&(linksCount-=1);var linkUI=allLinks[link.id];delete allLinks[link.id],linkProgram.removeLink(linkUI);var linkIdToRemove=linkUI.id;if(linkIdToRemove<linksCount){if(0===linksCount||linksCount===linkIdToRemove)return;var lastLinkUI=links[linksCount];links[linkIdToRemove]=lastLinkUI,lastLinkUI.id=linkIdToRemove}},releaseNode:function(node){nodesCount>0&&(nodesCount-=1);var nodeUI=allNodes[node.id];delete allNodes[node.id],nodeProgram.removeNode(nodeUI);var nodeIdToRemove=nodeUI.id;if(nodeIdToRemove<nodesCount){if(0===nodesCount||nodesCount===nodeIdToRemove)return;var lastNodeUI=nodes[nodesCount];nodes[nodeIdToRemove]=lastNodeUI,lastNodeUI.id=nodeIdToRemove,nodeProgram.replaceProperties(nodeUI,lastNodeUI)}},renderNodes:function(){for(var pos={x:0,y:0},i=0;i<nodesCount;++i){var ui=nodes[i];pos.x=ui.position.x,pos.y=ui.position.y,userPlaceNodeCallback&&userPlaceNodeCallback(ui,pos),nodeProgram.position(ui,pos)}},renderLinks:function(){if(!this.omitLinksRendering)for(var toPos={x:0,y:0},fromPos={x:0,y:0},i=0;i<linksCount;++i){var ui=links[i],pos=ui.pos.from;fromPos.x=pos.x,fromPos.y=-pos.y,pos=ui.pos.to,toPos.x=pos.x,toPos.y=-pos.y,userPlaceLinkCallback&&userPlaceLinkCallback(ui,fromPos,toPos),linkProgram.position(ui,fromPos,toPos)}},getGraphicsRoot:function(callbackWhenReady){return"function"==typeof callbackWhenReady&&(graphicsRoot?callbackWhenReady(graphicsRoot):initCallback=callbackWhenReady),graphicsRoot},setNodeProgram:function(newProgram){if(!gl&&newProgram)nodeProgram=newProgram;else if(newProgram)throw"Not implemented. Cannot swap shader on the fly... Yet."},setLinkProgram:function(newProgram){if(!gl&&newProgram)linkProgram=newProgram;else if(newProgram)throw"Not implemented. Cannot swap shader on the fly... Yet."},transformClientToGraphCoordinates:function(p){return p.x=2*p.x/width-1,p.y=1-2*p.y/height,p.x=(p.x-transform[12])/transform[0],p.y=(p.y-transform[13])/transform[5],p.x=p.x*(width/2),p.y=p.y*(-height/2),p},transformGraphToClientCoordinates:function(p){return p.x=p.x/(width/2),p.y=p.y/(-height/2),p.x=p.x*transform[0]+transform[12],p.y=p.y*transform[5]+transform[13],p.x=(p.x+1)*width/2,p.y=(1-p.y)*height/2,p},getNodeAtClientPos:function(clientPos,preciseCheck){if("function"!=typeof preciseCheck)return null;this.transformClientToGraphCoordinates(clientPos);for(var i=0;i<nodesCount;++i)if(preciseCheck(nodes[i],clientPos.x,clientPos.y))return nodes[i].node;return null}};return eventify(graphics),graphics}},{"../Input/webglInputManager.js":36,"../WebGL/webglLine.js":58,"../WebGL/webglLinkProgram.js":59,"../WebGL/webglNodeProgram.js":60,"../WebGL/webglSquare.js":61,"ngraph.events":7,"ngraph.merge":13}],51:[function(require,module,exports){function parseColor(color){var parsedColor=10414335;if("string"==typeof color&&color)if(4===color.length&&(color=color.replace(/([^#])/g,"$1$1")),9===color.length)parsedColor=parseInt(color.substr(1),16);else{if(7!==color.length)throw'Color expected in hex format with preceding "#". E.g. #00ff00. Got value: '+color;parsedColor=parseInt(color.substr(1),16)<<8|255}else"number"==typeof color&&(parsedColor=color);return parsedColor}module.exports=parseColor},{}],52:[function(require,module,exports){function Texture(size){this.canvas=window.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.isDirty=!1,this.canvas.width=this.canvas.height=size}module.exports=Texture},{}],53:[function(require,module,exports){function webgl(gl){return{createProgram:createProgram,extendArray:extendArray,copyArrayPart:copyArrayPart,swapArrayPart:swapArrayPart,getLocations:getLocations,context:gl};function createShader(shaderText,type){var shader=gl.createShader(type);if(gl.shaderSource(shader,shaderText),gl.compileShader(shader),!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var msg=gl.getShaderInfoLog(shader);throw window.alert(msg),msg}return shader}function createProgram(vertexShaderSrc,fragmentShaderSrc){var program=gl.createProgram(),vs=createShader(vertexShaderSrc,gl.VERTEX_SHADER),fs=createShader(fragmentShaderSrc,gl.FRAGMENT_SHADER);if(gl.attachShader(program,vs),gl.attachShader(program,fs),gl.linkProgram(program),!gl.getProgramParameter(program,gl.LINK_STATUS)){var msg=gl.getShaderInfoLog(program);throw window.alert(msg),msg}return program}function extendArray(buffer,itemsInBuffer,elementsPerItem){if((itemsInBuffer+1)*elementsPerItem>buffer.length){var extendedArray=new Float32Array(buffer.length*elementsPerItem*2);return extendedArray.set(buffer),extendedArray}return buffer}function getLocations(program,uniformOrAttributeNames){for(var foundLocations={},i=0;i<uniformOrAttributeNames.length;++i){var name=uniformOrAttributeNames[i],location=-1;if("a"===name[0]&&"_"===name[1]){if(-1===(location=gl.getAttribLocation(program,name)))throw new Error("Program doesn't have required attribute: "+name);foundLocations[name.slice(2)]=location}else{if("u"!==name[0]||"_"!==name[1])throw new Error("Couldn't figure out your intent. All uniforms should start with 'u_' prefix, and attributes with 'a_'");if(null===(location=gl.getUniformLocation(program,name)))throw new Error("Program doesn't have required uniform: "+name);foundLocations[name.slice(2)]=location}}return foundLocations}}function copyArrayPart(array,to,from,elementsCount){for(var i=0;i<elementsCount;++i)array[to+i]=array[from+i]}function swapArrayPart(array,from,to,elementsCount){for(var i=0;i<elementsCount;++i){var tmp=array[from+i];array[from+i]=array[to+i],array[to+i]=tmp}}module.exports=webgl},{}],54:[function(require,module,exports){var Texture=require("./texture.js");function webglAtlas(tilesPerTexture){var tilesPerRow=Math.sqrt(tilesPerTexture||1024)<<0,tileSize=tilesPerRow,lastLoadedIdx=1,loadedImages={},dirtyTimeoutId,skipedDirty=0,textures=[],trackedUrls=[];if(!isPowerOf2(tilesPerTexture))throw"Tiles per texture should be power of two.";var api={isDirty:!1,clearDirty:clearDirty,remove:remove,getTextures:getTextures,getCoordinates:getCoordinates,load:load};return api;function clearDirty(){var i;for(api.isDirty=!1,i=0;i<textures.length;++i)textures[i].isDirty=!1}function remove(imgUrl){var coordinates=loadedImages[imgUrl];if(!coordinates)return!1;if(delete loadedImages[imgUrl],(lastLoadedIdx-=1)===coordinates.offset)return!0;var tileToRemove=getTileCoordinates(coordinates.offset),lastTileInSet,replacedOffset;return copy(getTileCoordinates(lastLoadedIdx),tileToRemove),loadedImages[trackedUrls[lastLoadedIdx]].offset=coordinates.offset,trackedUrls[coordinates.offset]=trackedUrls[lastLoadedIdx],markDirty(),!0}function getTextures(){return textures}function getCoordinates(imgUrl){return loadedImages[imgUrl]}function load(imgUrl,callback){if(loadedImages.hasOwnProperty(imgUrl))callback(loadedImages[imgUrl]);else{var img=new window.Image,imgId=lastLoadedIdx;lastLoadedIdx+=1,img.crossOrigin="anonymous",img.onload=function(){markDirty(),drawAt(imgId,img,callback)},img.src=imgUrl}}function createTexture(){var texture=new Texture(tilesPerRow*tileSize);textures.push(texture)}function drawAt(tileNumber,img,callback){var tilePosition=getTileCoordinates(tileNumber),coordinates={offset:tileNumber};tilePosition.textureNumber>=textures.length&&createTexture();var currentTexture=textures[tilePosition.textureNumber];currentTexture.ctx.drawImage(img,tilePosition.col*tileSize,tilePosition.row*tileSize,tileSize,tileSize),trackedUrls[tileNumber]=img.src,loadedImages[img.src]=coordinates,currentTexture.isDirty=!0,callback(coordinates)}function getTileCoordinates(absolutePosition){var textureNumber,localTileNumber=absolutePosition%tilesPerTexture,row,col;return{textureNumber:absolutePosition/tilesPerTexture<<0,row:localTileNumber/tilesPerRow<<0,col:localTileNumber%tilesPerRow}}function markDirtyNow(){api.isDirty=!0,skipedDirty=0,dirtyTimeoutId=null}function markDirty(){dirtyTimeoutId&&(window.clearTimeout(dirtyTimeoutId),skipedDirty+=1,dirtyTimeoutId=null),skipedDirty>10?markDirtyNow():dirtyTimeoutId=window.setTimeout(markDirtyNow,400)}function copy(from,to){var fromCanvas=textures[from.textureNumber].canvas,toCtx=textures[to.textureNumber].ctx,x=to.col*tileSize,y=to.row*tileSize;toCtx.drawImage(fromCanvas,from.col*tileSize,from.row*tileSize,tileSize,tileSize,x,y,tileSize,tileSize),textures[from.textureNumber].isDirty=!0,textures[to.textureNumber].isDirty=!0}}function isPowerOf2(n){return 0==(n&n-1)}module.exports=webglAtlas},{"./texture.js":52}],55:[function(require,module,exports){function webglImage(size,src){return{_texture:0,_offset:0,size:"number"==typeof size?size:32,src:src}}module.exports=webglImage},{}],56:[function(require,module,exports){var WebglAtlas=require("./webglAtlas.js"),glUtils=require("./webgl.js");function webglImageNodeProgram(){var ATTRIBUTES_PER_PRIMITIVE=18,nodesFS=createNodeFragmentShader(),nodesVS=createNodeVertexShader(),tilesPerTexture=1024,atlas,program,gl,buffer,utils,locations,nodesCount=0,nodes=new Float32Array(64),width,height,transform,sizeDirty;return{load:load,position:position,createNode:createNode,removeNode:removeNode,replaceProperties:replaceProperties,updateTransform:updateTransform,updateSize:updateSize,render:render};function refreshTexture(texture,idx){texture.nativeObject&&gl.deleteTexture(texture.nativeObject);var nativeObject=gl.createTexture();gl.activeTexture(gl["TEXTURE"+idx]),gl.bindTexture(gl.TEXTURE_2D,nativeObject),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.canvas),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D),gl.uniform1i(locations["sampler"+idx],idx),texture.nativeObject=nativeObject}function ensureAtlasTextureUpdated(){if(atlas.isDirty){var textures=atlas.getTextures(),i;for(i=0;i<textures.length;++i)!textures[i].isDirty&&textures[i].nativeObject||refreshTexture(textures[i],i);atlas.clearDirty()}}function load(glContext){gl=glContext,utils=glUtils(glContext),atlas=new WebglAtlas(tilesPerTexture),program=utils.createProgram(nodesVS,nodesFS),gl.useProgram(program),locations=utils.getLocations(program,["a_vertexPos","a_customAttributes","u_screenSize","u_transform","u_sampler0","u_sampler1","u_sampler2","u_sampler3","u_tilesPerTexture"]),gl.uniform1f(locations.tilesPerTexture,tilesPerTexture),gl.enableVertexAttribArray(locations.vertexPos),gl.enableVertexAttribArray(locations.customAttributes),buffer=gl.createBuffer()}function position(nodeUI,pos){var idx=nodeUI.id*ATTRIBUTES_PER_PRIMITIVE;nodes[idx]=pos.x-nodeUI.size,nodes[idx+1]=pos.y-nodeUI.size,nodes[idx+2]=4*nodeUI._offset,nodes[idx+3]=pos.x+nodeUI.size,nodes[idx+4]=pos.y-nodeUI.size,nodes[idx+5]=4*nodeUI._offset+1,nodes[idx+6]=pos.x-nodeUI.size,nodes[idx+7]=pos.y+nodeUI.size,nodes[idx+8]=4*nodeUI._offset+2,nodes[idx+9]=pos.x-nodeUI.size,nodes[idx+10]=pos.y+nodeUI.size,nodes[idx+11]=4*nodeUI._offset+2,nodes[idx+12]=pos.x+nodeUI.size,nodes[idx+13]=pos.y-nodeUI.size,nodes[idx+14]=4*nodeUI._offset+1,nodes[idx+15]=pos.x+nodeUI.size,nodes[idx+16]=pos.y+nodeUI.size,nodes[idx+17]=4*nodeUI._offset+3}function createNode(ui){nodes=utils.extendArray(nodes,nodesCount,ATTRIBUTES_PER_PRIMITIVE),nodesCount+=1;var coordinates=atlas.getCoordinates(ui.src);coordinates?ui._offset=coordinates.offset:(ui._offset=0,atlas.load(ui.src,function(coordinates){ui._offset=coordinates.offset}))}function removeNode(nodeUI){nodesCount>0&&(nodesCount-=1),nodeUI.id<nodesCount&&nodesCount>0&&(nodeUI.src&&atlas.remove(nodeUI.src),utils.copyArrayPart(nodes,nodeUI.id*ATTRIBUTES_PER_PRIMITIVE,nodesCount*ATTRIBUTES_PER_PRIMITIVE,ATTRIBUTES_PER_PRIMITIVE))}function replaceProperties(replacedNode,newNode){newNode._offset=replacedNode._offset}function updateTransform(newTransform){sizeDirty=!0,transform=newTransform}function updateSize(w,h){width=w,height=h,sizeDirty=!0}function render(){gl.useProgram(program),gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,nodes,gl.DYNAMIC_DRAW),sizeDirty&&(sizeDirty=!1,gl.uniformMatrix4fv(locations.transform,!1,transform),gl.uniform2f(locations.screenSize,width,height)),gl.vertexAttribPointer(locations.vertexPos,2,gl.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),gl.vertexAttribPointer(locations.customAttributes,1,gl.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8),ensureAtlasTextureUpdated(),gl.drawArrays(gl.TRIANGLES,0,6*nodesCount)}}function createNodeFragmentShader(){return["precision mediump float;","varying vec4 color;","varying vec3 vTextureCoord;","uniform sampler2D u_sampler0;","uniform sampler2D u_sampler1;","uniform sampler2D u_sampler2;","uniform sampler2D u_sampler3;","void main(void) {","   if (vTextureCoord.z == 0.) {","     gl_FragColor = texture2D(u_sampler0, vTextureCoord.xy);","   } else if (vTextureCoord.z == 1.) {","     gl_FragColor = texture2D(u_sampler1, vTextureCoord.xy);","   } else if (vTextureCoord.z == 2.) {","     gl_FragColor = texture2D(u_sampler2, vTextureCoord.xy);","   } else if (vTextureCoord.z == 3.) {","     gl_FragColor = texture2D(u_sampler3, vTextureCoord.xy);","   } else { gl_FragColor = vec4(0, 1, 0, 1); }","}"].join("\n")}function createNodeVertexShader(){return["attribute vec2 a_vertexPos;","attribute float a_customAttributes;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","uniform float u_tilesPerTexture;","varying vec3 vTextureCoord;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0, 1);","float corner = mod(a_customAttributes, 4.);","float tileIndex = mod(floor(a_customAttributes / 4.), u_tilesPerTexture);","float tilesPerRow = sqrt(u_tilesPerTexture);","float tileSize = 1./tilesPerRow;","float tileColumn = mod(tileIndex, tilesPerRow);","float tileRow = floor(tileIndex/tilesPerRow);","if(corner == 0.0) {","  vTextureCoord.xy = vec2(0, 1);","} else if(corner == 1.0) {","  vTextureCoord.xy = vec2(1, 1);","} else if(corner == 2.0) {","  vTextureCoord.xy = vec2(0, 0);","} else {","  vTextureCoord.xy = vec2(1, 0);","}","vTextureCoord *= tileSize;","vTextureCoord.x += tileColumn * tileSize;","vTextureCoord.y += tileRow * tileSize;","vTextureCoord.z = floor(floor(a_customAttributes / 4.)/u_tilesPerTexture);","}"].join("\n")}module.exports=webglImageNodeProgram},{"./webgl.js":53,"./webglAtlas.js":54}],57:[function(require,module,exports){var documentEvents=require("../Utils/documentEvents.js");function webglInputEvents(webglGraphics){if(webglGraphics.webglInputEvents)return webglGraphics.webglInputEvents;var mouseCapturedNode=null,mouseEnterCallback=[],mouseLeaveCallback=[],mouseDownCallback=[],mouseUpCallback=[],mouseMoveCallback=[],clickCallback=[],dblClickCallback=[],prevSelectStart,boundRect,root;startListen(webglGraphics.getGraphicsRoot());var api={mouseEnter:mouseEnter,mouseLeave:mouseLeave,mouseDown:mouseDown,mouseUp:mouseUp,mouseMove:mouseMove,click:click,dblClick:dblClick,mouseCapture:mouseCapture,releaseMouseCapture:releaseMouseCapture};return webglGraphics.webglInputEvents=api,api;function releaseMouseCapture(){mouseCapturedNode=null}function mouseCapture(node){mouseCapturedNode=node}function dblClick(callback){return"function"==typeof callback&&dblClickCallback.push(callback),api}function click(callback){return"function"==typeof callback&&clickCallback.push(callback),api}function mouseMove(callback){return"function"==typeof callback&&mouseMoveCallback.push(callback),api}function mouseUp(callback){return"function"==typeof callback&&mouseUpCallback.push(callback),api}function mouseDown(callback){return"function"==typeof callback&&mouseDownCallback.push(callback),api}function mouseLeave(callback){return"function"==typeof callback&&mouseLeaveCallback.push(callback),api}function mouseEnter(callback){return"function"==typeof callback&&mouseEnterCallback.push(callback),api}function preciseCheck(nodeUI,x,y){if(nodeUI&&nodeUI.size){var pos=nodeUI.position,half=nodeUI.size;return pos.x-half<x&&x<pos.x+half&&pos.y-half<y&&y<pos.y+half}return!0}function getNodeAtClientPos(pos){return webglGraphics.getNodeAtClientPos(pos,preciseCheck)}function stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function handleDisabledEvent(e){return stopPropagation(e),!1}function invoke(callbacksChain,args){var i,stopPropagation;for(i=0;i<callbacksChain.length;i+=1)if(stopPropagation=callbacksChain[i].apply(void 0,args))return!0}function startListen(root){var pos={x:0,y:0},lastFound=null,lastUpdate=1,lastClickTime=+new Date,handleMouseMove=function(e){invoke(mouseMoveCallback,[lastFound,e]),pos.x=e.clientX,pos.y=e.clientY},handleMouseUp=function(){documentEvents.off("mousemove",handleMouseMove),documentEvents.off("mouseup",handleMouseUp)},updateBoundRect=function(){boundRect=root.getBoundingClientRect()};window.addEventListener("resize",updateBoundRect),updateBoundRect(),root.addEventListener("mousemove",function(e){if(!mouseCapturedNode){lastUpdate++%7==0&&(updateBoundRect(),lastUpdate=1);var cancelBubble=!1,node;pos.x=e.clientX-boundRect.left,pos.y=e.clientY-boundRect.top,(node=getNodeAtClientPos(pos))&&lastFound!==node?(lastFound=node,cancelBubble=cancelBubble||invoke(mouseEnterCallback,[lastFound])):null===node&&lastFound!==node&&(cancelBubble=cancelBubble||invoke(mouseLeaveCallback,[lastFound]),lastFound=null),cancelBubble&&stopPropagation(e)}}),root.addEventListener("mousedown",function(e){var cancelBubble=!1,args;updateBoundRect(),pos.x=e.clientX-boundRect.left,pos.y=e.clientY-boundRect.top,(args=[getNodeAtClientPos(pos),e])[0]?(cancelBubble=invoke(mouseDownCallback,args),documentEvents.on("mousemove",handleMouseMove),documentEvents.on("mouseup",handleMouseUp),prevSelectStart=window.document.onselectstart,window.document.onselectstart=handleDisabledEvent,lastFound=args[0]):lastFound=null,cancelBubble&&stopPropagation(e)}),root.addEventListener("mouseup",function(e){var clickTime=+new Date,args;pos.x=e.clientX-boundRect.left,pos.y=e.clientY-boundRect.top;var nodeAtClientPos=getNodeAtClientPos(pos),sameNode=nodeAtClientPos===lastFound;(args=[nodeAtClientPos||lastFound,e])[0]&&(window.document.onselectstart=prevSelectStart,invoke(clickTime-lastClickTime<400&&sameNode?dblClickCallback:clickCallback,args),lastClickTime=clickTime,invoke(mouseUpCallback,args)&&stopPropagation(e))})}}module.exports=webglInputEvents},{"../Utils/documentEvents.js":40}],58:[function(require,module,exports){var parseColor=require("./parseColor.js");function webglLine(color){return{color:parseColor(color)}}module.exports=webglLine},{"./parseColor.js":51}],59:[function(require,module,exports){var glUtils=require("./webgl.js");function webglLinkProgram(){var ATTRIBUTES_PER_PRIMITIVE=6,BYTES_PER_LINK=2*(2*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT),linksFS=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),linksVS=["attribute vec2 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0.0, 1.0);","   color = a_color.abgr;","}"].join("\n"),program,gl,buffer,utils,locations,linksCount=0,frontLinkId,storage=new ArrayBuffer(16*BYTES_PER_LINK),positions=new Float32Array(storage),colors=new Uint32Array(storage),width,height,transform,sizeDirty,ensureEnoughStorage=function(){if((linksCount+1)*BYTES_PER_LINK>storage.byteLength){var extendedStorage=new ArrayBuffer(2*storage.byteLength),extendedPositions=new Float32Array(extendedStorage),extendedColors=new Uint32Array(extendedStorage);extendedColors.set(colors),positions=extendedPositions,colors=extendedColors,storage=extendedStorage}};return{load:function(glContext){gl=glContext,utils=glUtils(glContext),program=utils.createProgram(linksVS,linksFS),gl.useProgram(program),locations=utils.getLocations(program,["a_vertexPos","a_color","u_screenSize","u_transform"]),gl.enableVertexAttribArray(locations.vertexPos),gl.enableVertexAttribArray(locations.color),buffer=gl.createBuffer()},position:function(linkUi,fromPos,toPos){var linkIdx,offset=6*linkUi.id;positions[offset]=fromPos.x,positions[offset+1]=fromPos.y,colors[offset+2]=linkUi.color,positions[offset+3]=toPos.x,positions[offset+4]=toPos.y,colors[offset+5]=linkUi.color},createLink:function(ui){ensureEnoughStorage(),linksCount+=1,frontLinkId=ui.id},removeLink:function(ui){linksCount>0&&(linksCount-=1),ui.id<linksCount&&linksCount>0&&utils.copyArrayPart(colors,6*ui.id,6*linksCount,6)},updateTransform:function(newTransform){sizeDirty=!0,transform=newTransform},updateSize:function(w,h){width=w,height=h,sizeDirty=!0},render:function(){gl.useProgram(program),gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,storage,gl.DYNAMIC_DRAW),sizeDirty&&(sizeDirty=!1,gl.uniformMatrix4fv(locations.transform,!1,transform),gl.uniform2f(locations.screenSize,width,height)),gl.vertexAttribPointer(locations.vertexPos,2,gl.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),gl.vertexAttribPointer(locations.color,4,gl.UNSIGNED_BYTE,!0,3*Float32Array.BYTES_PER_ELEMENT,8),gl.drawArrays(gl.LINES,0,2*linksCount),frontLinkId=linksCount-1},bringToFront:function(link){frontLinkId>link.id&&utils.swapArrayPart(positions,6*link.id,6*frontLinkId,6),frontLinkId>0&&(frontLinkId-=1)},getFrontLinkId:function(){return frontLinkId}}}module.exports=webglLinkProgram},{"./webgl.js":53}],60:[function(require,module,exports){var glUtils=require("./webgl.js");function webglNodeProgram(){var ATTRIBUTES_PER_PRIMITIVE=4,BYTES_PER_NODE=3*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT,nodesFS=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),nodesVS=["attribute vec3 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos.xy/u_screenSize, 0, 1);","   gl_PointSize = a_vertexPos.z * u_transform[0][0];","   color = a_color.abgr;","}"].join("\n"),program,gl,buffer,locations,utils,storage=new ArrayBuffer(16*BYTES_PER_NODE),positions=new Float32Array(storage),colors=new Uint32Array(storage),nodesCount=0,width,height,transform,sizeDirty;return{load:load,position:position,updateTransform:updateTransform,updateSize:updateSize,removeNode:removeNode,createNode:createNode,replaceProperties:replaceProperties,render:render};function ensureEnoughStorage(){if((nodesCount+1)*BYTES_PER_NODE>=storage.byteLength){var extendedStorage=new ArrayBuffer(2*storage.byteLength),extendedPositions=new Float32Array(extendedStorage),extendedColors=new Uint32Array(extendedStorage);extendedColors.set(colors),positions=extendedPositions,colors=extendedColors,storage=extendedStorage}}function load(glContext){gl=glContext,utils=glUtils(glContext),program=utils.createProgram(nodesVS,nodesFS),gl.useProgram(program),locations=utils.getLocations(program,["a_vertexPos","a_color","u_screenSize","u_transform"]),gl.enableVertexAttribArray(locations.vertexPos),gl.enableVertexAttribArray(locations.color),buffer=gl.createBuffer()}function position(nodeUI,pos){var idx=nodeUI.id;positions[idx*ATTRIBUTES_PER_PRIMITIVE]=pos.x,positions[idx*ATTRIBUTES_PER_PRIMITIVE+1]=-pos.y,positions[idx*ATTRIBUTES_PER_PRIMITIVE+2]=nodeUI.size,colors[idx*ATTRIBUTES_PER_PRIMITIVE+3]=nodeUI.color}function updateTransform(newTransform){sizeDirty=!0,transform=newTransform}function updateSize(w,h){width=w,height=h,sizeDirty=!0}function removeNode(node){nodesCount>0&&(nodesCount-=1),node.id<nodesCount&&nodesCount>0&&utils.copyArrayPart(colors,node.id*ATTRIBUTES_PER_PRIMITIVE,nodesCount*ATTRIBUTES_PER_PRIMITIVE,ATTRIBUTES_PER_PRIMITIVE)}function createNode(){ensureEnoughStorage(),nodesCount+=1}function replaceProperties(){}function render(){gl.useProgram(program),gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,storage,gl.DYNAMIC_DRAW),sizeDirty&&(sizeDirty=!1,gl.uniformMatrix4fv(locations.transform,!1,transform),gl.uniform2f(locations.screenSize,width,height)),gl.vertexAttribPointer(locations.vertexPos,3,gl.FLOAT,!1,ATTRIBUTES_PER_PRIMITIVE*Float32Array.BYTES_PER_ELEMENT,0),gl.vertexAttribPointer(locations.color,4,gl.UNSIGNED_BYTE,!0,ATTRIBUTES_PER_PRIMITIVE*Float32Array.BYTES_PER_ELEMENT,12),gl.drawArrays(gl.POINTS,0,nodesCount)}}module.exports=webglNodeProgram},{"./webgl.js":53}],61:[function(require,module,exports){var parseColor=require("./parseColor.js");function webglSquare(size,color){return{size:"number"==typeof size?size:10,color:parseColor(color)}}module.exports=webglSquare},{"./parseColor.js":51}],62:[function(require,module,exports){module.exports="0.8.1"},{}]},{},[1])(1)});